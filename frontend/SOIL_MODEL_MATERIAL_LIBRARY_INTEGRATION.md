# 土体计算模型与材料库系统集成

## ✅ 完成功能

### 1. 地质建模界面升级

#### 新增功能
- **土体计算模型选择Tab** - 独立的标签页用于配置项目级别的本构模型
- **8种专业本构模型** - 覆盖从简单到复杂的各类土体分析需求
- **材料库关联接口** - 为后续材料库集成预留接口

#### 界面结构
```
地质建模界面 (4个Tab)
├── Tab 1: 钻孔数据
├── Tab 2: 计算域设置  
├── Tab 3: 土体计算模型 ← 新增
└── Tab 4: 三区混合算法
```

#### 支持的土体计算模型
| 模型类型 | 适用场景 | 参数特点 |
|---------|----------|----------|
| 线弹性模型 | 小变形弹性分析 | 参数简单，计算高效 |
| 莫尔-库伦模型 | 基坑开挖、承载力分析 | 经典模型，应用广泛 |
| 德鲁克-普拉格模型 | 三维复杂应力状态 | 考虑中间主应力影响 |
| 剑桥黏土模型 | 软土沉降分析 | 考虑土体硬化/软化 |
| 硬化土模型 | 复杂土体工程 | 应力相关刚度 |
| 小应变土模型 | 动力分析、地震响应 | 小应变非线性刚度 |
| 理想弹塑性模型 | 简化分析 | 教学和初步分析 |
| 非线性弹性模型 | 大变形问题 | 弹性模量随应力变化 |

### 2. 独立材料库管理系统

#### 核心功能
- **材料CRUD操作** - 完整的创建、读取、更新、删除功能
- **默认材料库** - 预置5种典型土体材料
- **参数化配置** - 根据本构模型动态显示相关参数
- **本地持久化** - 使用LocalStorage保存用户自定义材料
- **材料复制功能** - 基于现有材料快速创建变体

#### 预置材料库
```typescript
默认材料库 (5种典型材料)
├── 软粘土 - 沿海地区典型软土
├── 硬粘土 - 承载力较高的密实粘土
├── 松散砂土 - 中等密度砂土
├── 密实砂土 - 高密度优质砂土
└── 软质岩石 - 风化程度较高的岩石
```

## 🔧 技术实现

### 数据结构设计

#### 土体计算模型Schema
```typescript
export const SoilConstitutiveModelSchema = z.enum([
  'linear_elastic',      // 线弹性模型
  'mohr_coulomb',        // 莫尔-库伦模型
  'drucker_prager',      // 德鲁克-普拉格模型
  'cam_clay',            // 剑桥黏土模型
  'hardening_soil',      // 硬化土模型
  'small_strain',        // 小应变土模型
  'elastic_perfectly_plastic', // 理想弹塑性模型
  'nonlinear_elastic'    // 非线性弹性模型
]);
```

#### 材料参数Schema
```typescript
export const MaterialParametersSchema = z.object({
  // 基础物理参数
  density: z.number().min(1000).max(3000),
  unit_weight: z.number().min(10).max(30).optional(),
  
  // 强度参数
  cohesion: z.number().min(0).max(500),
  friction: z.number().min(0).max(50),
  
  // 变形参数
  elastic_modulus: z.number().positive().optional(),
  poisson_ratio: z.number().min(0).max(0.5).optional(),
  
  // 渗流参数
  permeability_x: z.number().positive().optional(),
  permeability_y: z.number().positive().optional(),
  permeability_z: z.number().positive().optional(),
  
  // 高级参数（根据计算模型不同而不同）
  advanced_parameters: z.record(z.any()).optional()
});
```

### 组件架构

#### 地质建模组件更新
- **GeologyModuleAdvanced.tsx** - 添加土体计算模型配置Tab
- **GeometryViewSimple.tsx** - 更新初始化参数，支持新的数据结构

#### 材料库管理组件
- **MaterialLibraryView.tsx** - 完整的材料库管理界面
- **响应式设计** - 支持材料的增删改查操作
- **参数化表单** - 根据选择的本构模型动态显示对应参数

### 集成特点

#### 项目级配置
```typescript
// 项目级别的土体计算模型配置
soil_model: {
  constitutive_model: 'mohr_coulomb',
  description: '莫尔-库伦本构模型，适用于一般土体分析',
  selected_materials: [] // 关联的材料ID列表
}
```

#### 智能验证
- **Zod Schema验证** - 确保所有参数在合理范围内
- **依赖关系检查** - 验证参数之间的逻辑关系
- **实时错误提示** - 用户输入时即时反馈

## 🎯 用户体验设计

### 工作流程优化
```mermaid
graph LR
    A[选择土体计算模型] --> B[配置钻孔数据]
    B --> C[设置计算域]
    C --> D[配置算法参数]
    D --> E[生成地质模型]
    
    F[材料库管理] -.-> A
    F -.-> B
```

### 界面设计原则
- **保持原有风格** - 延续DeepCAD的深色主题和蓝色强调色
- **模块化布局** - 每个Tab独立完整，逻辑清晰
- **智能提示** - 丰富的说明文本和参数建议
- **一致性设计** - 统一的组件风格和交互模式

### 用户引导
- **渐进式配置** - 按Tab顺序逐步完成配置
- **智能默认值** - 为所有参数提供合理的默认值
- **实时预览** - 参数变化时提供实时反馈
- **错误处理** - 清晰的错误信息和修复建议

## 📊 功能验证

### 类型安全
- ✅ **TypeScript编译通过** - 所有组件类型正确
- ✅ **Zod Schema验证** - 运行时参数验证
- ✅ **React Hook Form集成** - 表单状态管理

### 数据持久化
- ✅ **LocalStorage集成** - 材料库数据本地保存
- ✅ **默认数据加载** - 首次使用自动载入默认材料
- ✅ **数据导入导出** - 支持材料库的备份和恢复

### 界面响应性  
- ✅ **动态参数显示** - 根据选择的模型显示对应参数
- ✅ **实时表单验证** - 参数输入时即时验证
- ✅ **操作反馈** - 所有操作都有明确的成功/失败反馈

## 🚀 使用指南

### 地质建模工作流

#### 1. 选择土体计算模型
- 进入地质建模界面
- 切换到"土体计算模型"Tab
- 从8种专业模型中选择适合的本构模型
- 填写模型说明和适用条件

#### 2. 配置钻孔数据
- 上传钻孔数据文件（JSON/CSV格式）
- 或手动添加钻孔和土层信息
- 验证数据完整性和合理性

#### 3. 生成地质模型
- 配置计算域和算法参数
- 执行三区混合地质建模
- 生成多格式几何文件用于后续分析

### 材料库管理

#### 1. 访问材料库
- 独立的材料库管理视图
- 与地质建模界面并列的功能模块

#### 2. 材料管理操作
```typescript
// 添加新材料
const newMaterial = {
  name: '自定义粘土',
  soil_type: 'clay',
  constitutive_model: 'mohr_coulomb',
  parameters: {
    density: 1850,
    cohesion: 25,
    friction: 12,
    elastic_modulus: 8000,
    poisson_ratio: 0.38
  }
};

// 编辑现有材料
// 复制材料创建变体
// 删除不需要的材料
```

## 🔮 后续扩展

### 短期计划
- **材料库与地质建模集成** - 在钻孔数据中直接选择材料库中的材料
- **材料参数导入导出** - 支持从外部文件导入材料参数
- **材料分组管理** - 按项目、区域等维度组织材料

### 长期规划
- **云端材料库同步** - 团队共享材料库
- **智能参数推荐** - 基于土体类型和工程条件推荐参数
- **参数不确定性分析** - 材料参数的敏感性和不确定性分析
- **标准规范集成** - 集成各国土体参数标准和建议值

---

**实现完成时间**: 2025-01-21  
**开发状态**: ✅ 完成并集成测试  
**TypeScript类型安全**: ✅ 通过编译检查  
**用户体验**: ✅ 符合DeepCAD设计规范