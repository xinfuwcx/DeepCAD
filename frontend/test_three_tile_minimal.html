<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>three-tile æœ€å°å¯å·¥ä½œç¤ºä¾‹</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB; /* å¤©è“è‰²èƒŒæ™¯ï¼Œä¾¿äºå¯¹æ¯” */
            font-family: Arial, sans-serif;
        }
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 12px;
            line-height: 1.4;
        }
        .status {
            margin: 2px 0;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info">
        <div class="status" id="status-init">ğŸ”„ åˆå§‹åŒ–ä¸­...</div>
        <div class="status" id="status-source">ğŸ“¡ åˆ›å»ºæ•°æ®æº...</div>
        <div class="status" id="status-map">ğŸ—ºï¸ åˆ›å»ºåœ°å›¾...</div>
        <div class="status" id="status-render">ğŸ¨ å¼€å§‹æ¸²æŸ“...</div>
        <div class="status" id="debug-info"></div>
    </div>

    <script type="module">
        // å¯¼å…¥å¿…è¦çš„åº“
        import * as THREE from 'https://unpkg.com/three@0.171.0/build/three.module.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.171.0/examples/jsm/controls/OrbitControls.js';
        
        // ç”±äºæ— æ³•ç›´æ¥ä» CDN å¯¼å…¥ three-tileï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¬åœ°çš„ node_modules ç‰ˆæœ¬
        // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåº”è¯¥ä»ä½ çš„æ„å»ºç³»ç»Ÿä¸­å¯¼å…¥
        console.log('ğŸ”„ å¼€å§‹ three-tile æœ€å°ç¤ºä¾‹æµ‹è¯•...');
        
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `status ${type}`;
        }
        
        function updateDebugInfo(info) {
            document.getElementById('debug-info').innerHTML = info;
        }
        
        async function initThreeTileTest() {
            try {
                updateStatus('status-init', 'âœ… Three.js åˆå§‹åŒ–å®Œæˆ', 'success');
                
                // åˆ›å»ºåŸºç¡€ Three.js ç»„ä»¶
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
                const renderer = new THREE.WebGLRenderer({ 
                    antialias: true, 
                    alpha: true 
                });
                
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x87CEEB, 1); // å¤©è“è‰²èƒŒæ™¯
                document.getElementById('container').appendChild(renderer.domElement);
                
                // è®¾ç½®ç›¸æœºåˆå§‹ä½ç½®
                camera.position.set(0, 1000, 0);
                camera.lookAt(0, 0, 0);
                
                // åˆ›å»ºæ§åˆ¶å™¨
                const controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 10;
                controls.maxDistance = 5000;
                
                // æ·»åŠ åŸºç¡€å…‰ç…§
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
                directionalLight.position.set(100, 100, 50);
                scene.add(ambientLight);
                scene.add(directionalLight);
                
                updateStatus('status-init', 'âœ… Three.js åœºæ™¯è®¾ç½®å®Œæˆ', 'success');
                
                // ç”±äºæ— æ³•ç›´æ¥æµ‹è¯• three-tileï¼ˆéœ€è¦æ„å»ºç¯å¢ƒï¼‰ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„åœ°å›¾å¹³é¢
                updateStatus('status-source', 'âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿåœ°å›¾æ•°æ®æºï¼ˆthree-tile éœ€è¦æ„å»ºç¯å¢ƒï¼‰', 'warning');
                
                // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„åœ°å›¾å¹³é¢æ¥å±•ç¤ºåº”è¯¥å¦‚ä½•æ˜¾ç¤º
                const mapGeometry = new THREE.PlaneGeometry(2000, 2000, 50, 50);
                
                // æ·»åŠ ç®€å•çš„é«˜åº¦å˜åŒ–
                const vertices = mapGeometry.attributes.position.array;
                for (let i = 0; i < vertices.length; i += 3) {
                    const x = vertices[i];
                    const y = vertices[i + 1];
                    vertices[i + 2] = Math.sin(x * 0.01) * Math.cos(y * 0.01) * 20;
                }
                mapGeometry.attributes.position.needsUpdate = true;
                mapGeometry.computeVertexNormals();
                
                // åˆ›å»ºåœ°å›¾æè´¨ï¼ˆæ¨¡æ‹Ÿç“¦ç‰‡çº¹ç†ï¼‰
                const canvas = document.createElement('canvas');
                canvas.width = 512;
                canvas.height = 512;
                const context = canvas.getContext('2d');
                
                // ç»˜åˆ¶æ¨¡æ‹Ÿçš„åœ°å›¾ç“¦ç‰‡
                context.fillStyle = '#4a90e2';
                context.fillRect(0, 0, 512, 512);
                
                // æ·»åŠ ç½‘æ ¼çº¿æ¨¡æ‹Ÿè¡—é“
                context.strokeStyle = '#ffffff';
                context.lineWidth = 2;
                for (let i = 0; i < 512; i += 64) {
                    context.beginPath();
                    context.moveTo(i, 0);
                    context.lineTo(i, 512);
                    context.stroke();
                    
                    context.beginPath();
                    context.moveTo(0, i);
                    context.lineTo(512, i);
                    context.stroke();
                }
                
                const mapTexture = new THREE.CanvasTexture(canvas);
                const mapMaterial = new THREE.MeshLambertMaterial({
                    map: mapTexture,
                    transparent: false
                });
                
                const mapMesh = new THREE.Mesh(mapGeometry, mapMaterial);
                mapMesh.rotation.x = -Math.PI / 2; // ä½¿å¹³é¢æ°´å¹³
                mapMesh.name = 'mock-tile-map';
                
                scene.add(mapMesh);
                updateStatus('status-map', 'âœ… æ¨¡æ‹Ÿåœ°å›¾åˆ›å»ºå®Œæˆ', 'success');
                
                // æ·»åŠ ä¸€äº›æ ‡è®°ç‚¹æ¨¡æ‹Ÿé¡¹ç›®ä½ç½®
                const markerGeometry = new THREE.ConeGeometry(20, 60, 8);
                const markerMaterial = new THREE.MeshLambertMaterial({ color: 0xff4444 });
                
                const positions = [
                    { x: 200, z: 200, name: 'ä¸Šæµ·é¡¹ç›®' },
                    { x: -300, z: 100, name: 'åŒ—äº¬é¡¹ç›®' },
                    { x: 100, z: -400, name: 'æ·±åœ³é¡¹ç›®' }
                ];
                
                positions.forEach(pos => {
                    const marker = new THREE.Mesh(markerGeometry, markerMaterial);
                    marker.position.set(pos.x, 30, pos.z);
                    scene.add(marker);
                });
                
                updateStatus('status-render', 'âœ… å¼€å§‹æ¸²æŸ“å¾ªç¯', 'success');
                
                // æ¸²æŸ“å¾ªç¯
                let frameCount = 0;
                function animate() {
                    requestAnimationFrame(animate);
                    
                    controls.update();
                    camera.updateMatrixWorld();
                    
                    renderer.render(scene, camera);
                    
                    // æ¯60å¸§æ›´æ–°ä¸€æ¬¡è°ƒè¯•ä¿¡æ¯
                    if (frameCount % 60 === 0) {
                        updateDebugInfo(`
                            ğŸ“Š æ¸²æŸ“ç»Ÿè®¡: ${frameCount} å¸§<br>
                            ğŸ“¹ ç›¸æœºä½ç½®: (${camera.position.x.toFixed(1)}, ${camera.position.y.toFixed(1)}, ${camera.position.z.toFixed(1)})<br>
                            ğŸ”º åœºæ™¯å¯¹è±¡: ${scene.children.length} ä¸ª<br>
                            ğŸ’¡ çŠ¶æ€: æ­£å¸¸è¿è¡Œä¸­
                        `);
                    }
                    frameCount++;
                }
                
                animate();
                
                // çª—å£å¤§å°è°ƒæ•´
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });
                
                console.log('âœ… three-tile æœ€å°ç¤ºä¾‹æµ‹è¯•å®Œæˆï¼');
                console.log('ğŸ“ ä½¿ç”¨è¯´æ˜:');
                console.log('  - é¼ æ ‡å·¦é”®æ‹–æ‹½ï¼šæ—‹è½¬è§†è§’');
                console.log('  - é¼ æ ‡æ»šè½®ï¼šç¼©æ”¾');
                console.log('  - é¼ æ ‡å³é”®æ‹–æ‹½ï¼šå¹³ç§»');
                console.log('  - å¦‚æœä½ çœ‹åˆ°äº†ç½‘æ ¼çŠ¶çš„è“è‰²åœ°é¢å’Œçº¢è‰²æ ‡è®°ï¼Œè¯´æ˜åŸºç¡€æ¸²æŸ“æ­£å¸¸');
                console.log('  - åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªæ¨¡æ‹Ÿåœ°é¢åº”è¯¥è¢« three-tile çš„çœŸå®åœ°å›¾ç“¦ç‰‡æ›¿ä»£');
                
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
                updateStatus('status-init', `âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å¯åŠ¨æµ‹è¯•
        initThreeTileTest();
        
    </script>
</body>
</html>