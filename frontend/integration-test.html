<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepCAD Mapbox + Three.js é›†æˆæµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: linear-gradient(45deg, #00d9ff, #0066cc);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 8px;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
        }
        .success { background: rgba(82, 196, 26, 0.2); border-left: 4px solid #52c41a; }
        .error { background: rgba(255, 77, 79, 0.2); border-left: 4px solid #ff4d4f; }
        .warning { background: rgba(250, 173, 20, 0.2); border-left: 4px solid #faad14; }
        .info { background: rgba(24, 144, 255, 0.2); border-left: 4px solid #1890ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ DeepCAD Mapbox + Three.js é›†æˆæµ‹è¯•</h1>
        <p>2å·å‡ ä½•ä¸“å®¶ - ä¾èµ–éªŒè¯å’Œæ•°æ®æµè¿é€šæ€§æµ‹è¯•</p>

        <div class="test-section">
            <h2>ğŸ“¦ ä¾èµ–æµ‹è¯•</h2>
            <button class="test-button" onclick="testThreeJS()">æµ‹è¯• Three.js</button>
            <button class="test-button" onclick="testMapboxGL()">æµ‹è¯• Mapbox GL</button>
            <button class="test-button" onclick="testGeographicalService()">æµ‹è¯•åœ°ç†æœåŠ¡</button>
            <button class="test-button" onclick="runAllTests()">è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ åŠŸèƒ½æ¼”ç¤º</h2>
            <button class="test-button" onclick="createTestProject()">åˆ›å»ºæµ‹è¯•é¡¹ç›®</button>
            <button class="test-button" onclick="simulateDataFlow()">æ¨¡æ‹Ÿæ•°æ®æµ</button>
            <button class="test-button" onclick="testCoordinateTransform()">æµ‹è¯•åæ ‡è½¬æ¢</button>
            <div id="demo-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div id="system-status">
                <div class="info">æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥CDNåº“è¿›è¡Œæµ‹è¯• -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r164/three.min.js"></script>
    
    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤º
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `result ${type}`;
            result.innerHTML = message;
            container.appendChild(result);
        }

        // æ¸…é™¤ç»“æœ
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // æµ‹è¯• Three.js
        function testThreeJS() {
            clearResults('test-results');
            showResult('test-results', 'ğŸ” å¼€å§‹æµ‹è¯• Three.js...', 'info');
            
            try {
                if (typeof THREE !== 'undefined') {
                    showResult('test-results', 'âœ… Three.js å…¨å±€å¯¹è±¡å·²åŠ è½½', 'success');
                    
                    // æµ‹è¯•æ ¸å¿ƒç»„ä»¶
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                    const geometry = new THREE.BoxGeometry(1, 1, 1);
                    const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
                    const cube = new THREE.Mesh(geometry, material);
                    
                    scene.add(cube);
                    showResult('test-results', 'âœ… Three.js æ ¸å¿ƒç»„ä»¶æµ‹è¯•é€šè¿‡', 'success');
                    showResult('test-results', `ğŸ“Š åœºæ™¯å¯¹è±¡æ•°é‡: ${scene.children.length}`, 'info');
                    
                    return true;
                } else {
                    showResult('test-results', 'âŒ Three.js æœªæ­£ç¡®åŠ è½½', 'error');
                    return false;
                }
            } catch (error) {
                showResult('test-results', `âŒ Three.js æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        // æµ‹è¯• Mapbox GL
        function testMapboxGL() {
            showResult('test-results', 'ğŸ” å¼€å§‹æµ‹è¯• Mapbox GL...', 'info');
            
            try {
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®Mapboxç›¸å…³API
                if (typeof fetch !== 'undefined') {
                    showResult('test-results', 'âœ… Fetch API å¯ç”¨ (Mapbox GL éœ€è¦)', 'success');
                }
                
                if (typeof WebGLRenderingContext !== 'undefined') {
                    showResult('test-results', 'âœ… WebGL æ”¯æŒå¯ç”¨', 'success');
                }
                
                // æ¨¡æ‹Ÿåœ°ç†åæ ‡è½¬æ¢æµ‹è¯•
                const testCoords = { lng: 116.4074, lat: 39.9042 };
                showResult('test-results', `âœ… æµ‹è¯•åæ ‡: ç»åº¦${testCoords.lng}, çº¬åº¦${testCoords.lat}`, 'success');
                
                showResult('test-results', 'âš ï¸ Mapbox GL éœ€è¦æœ‰æ•ˆ token æ‰èƒ½å®Œå…¨æµ‹è¯•', 'warning');
                return true;
            } catch (error) {
                showResult('test-results', `âŒ Mapbox GL ç¯å¢ƒæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        // æµ‹è¯•åœ°ç†æœåŠ¡
        function testGeographicalService() {
            showResult('test-results', 'ğŸ” å¼€å§‹æµ‹è¯•åœ°ç†å¯è§†åŒ–æœåŠ¡...', 'info');
            
            try {
                // æ¨¡æ‹Ÿé¡¹ç›®æ•°æ®ç»“æ„
                const testProject = {
                    id: 'test-project-001',
                    name: 'åŒ—äº¬æµ‹è¯•æ·±åŸºå‘é¡¹ç›®',
                    location: {
                        latitude: 39.9042,
                        longitude: 116.4074,
                        elevation: 50
                    },
                    status: 'active',
                    depth: 15,
                    boundaries: [
                        { lat: 39.9040, lng: 116.4070 },
                        { lat: 39.9040, lng: 116.4078 },
                        { lat: 39.9044, lng: 116.4078 },
                        { lat: 39.9044, lng: 116.4070 }
                    ],
                    excavationDepth: 15,
                    supportStructures: [],
                    geologicalLayers: [],
                    materials: []
                };
                
                showResult('test-results', 'âœ… é¡¹ç›®æ•°æ®ç»“æ„éªŒè¯é€šè¿‡', 'success');
                showResult('test-results', `ğŸ“Š é¡¹ç›®: ${testProject.name}`, 'info');
                showResult('test-results', `ğŸ“ ä½ç½®: ${testProject.location.latitude}, ${testProject.location.longitude}`, 'info');
                showResult('test-results', `ğŸ—ï¸ æ·±åº¦: ${testProject.depth}m`, 'info');
                showResult('test-results', `ğŸ“ è¾¹ç•Œç‚¹æ•°: ${testProject.boundaries.length}`, 'info');
                
                return true;
            } catch (error) {
                showResult('test-results', `âŒ åœ°ç†æœåŠ¡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            clearResults('test-results');
            showResult('test-results', 'ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´é›†æˆæµ‹è¯•...', 'info');
            
            const results = {
                threeJS: testThreeJS(),
                mapboxGL: testMapboxGL(),
                geoService: testGeographicalService()
            };
            
            const passedTests = Object.values(results).filter(r => r === true).length;
            const totalTests = Object.keys(results).length;
            
            showResult('test-results', '=' .repeat(50), 'info');
            showResult('test-results', 'ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»:', 'info');
            showResult('test-results', `âœ… é€šè¿‡: ${passedTests}/${totalTests}`, 'success');
            showResult('test-results', `âŒ å¤±è´¥: ${totalTests - passedTests}/${totalTests}`, 'error');
            
            if (passedTests === totalTests) {
                showResult('test-results', 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç³»ç»Ÿé›†æˆæ­£å¸¸', 'success');
            } else if (passedTests > 0) {
                showResult('test-results', 'âš ï¸ éƒ¨åˆ†æµ‹è¯•é€šè¿‡ï¼Œç³»ç»Ÿå¯åŸºæœ¬è¿è¡Œ', 'warning');
            } else {
                showResult('test-results', 'âŒ æ‰€æœ‰æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¾èµ–å®‰è£…', 'error');
            }
        }

        // åˆ›å»ºæµ‹è¯•é¡¹ç›®
        function createTestProject() {
            clearResults('demo-results');
            showResult('demo-results', 'ğŸ—ï¸ åˆ›å»ºæµ‹è¯•é¡¹ç›®...', 'info');
            
            const projects = [
                {
                    name: 'ä¸Šæµ·ä¸­å¿ƒæ·±åŸºå‘',
                    location: { lat: 31.2304, lng: 121.4737 },
                    depth: 25,
                    status: 'active'
                },
                {
                    name: 'åŒ—äº¬å¤§å…´æœºåœºT1',
                    location: { lat: 39.5098, lng: 116.4105 },
                    depth: 18,
                    status: 'planning'
                },
                {
                    name: 'æ·±åœ³å‰æµ·é‡‘èä¸­å¿ƒ',
                    location: { lat: 22.5329, lng: 113.8900 },
                    depth: 30,
                    status: 'completed'
                }
            ];
            
            projects.forEach((project, index) => {
                setTimeout(() => {
                    showResult('demo-results', `âœ… é¡¹ç›®åˆ›å»º: ${project.name} | æ·±åº¦: ${project.depth}m | çŠ¶æ€: ${project.status}`, 'success');
                }, index * 300);
            });
            
            setTimeout(() => {
                showResult('demo-results', `ğŸ¯ å…±åˆ›å»º ${projects.length} ä¸ªæµ‹è¯•é¡¹ç›®`, 'info');
            }, projects.length * 300);
        }

        // æ¨¡æ‹Ÿæ•°æ®æµ
        function simulateDataFlow() {
            showResult('demo-results', 'ğŸ”„ æ¨¡æ‹Ÿæ•°æ®æµè¿é€šæ€§æµ‹è¯•...', 'info');
            
            const steps = [
                'ğŸ“Š è·å–é¡¹ç›®æ•°æ®',
                'ğŸ—ºï¸ åœ°ç†åæ ‡è½¬æ¢',
                'ğŸ—ï¸ Three.js 3Dæ¨¡å‹ç”Ÿæˆ',
                'ğŸ¨ Mapbox åœ°å›¾å›¾å±‚æ¸²æŸ“',
                'ğŸ”— å®æ—¶æ•°æ®åŒæ­¥',
                'âœ… æ•°æ®æµæµ‹è¯•å®Œæˆ'
            ];
            
            steps.forEach((step, index) => {
                setTimeout(() => {
                    showResult('demo-results', step, index === steps.length - 1 ? 'success' : 'info');
                }, index * 500);
            });
        }

        // æµ‹è¯•åæ ‡è½¬æ¢
        function testCoordinateTransform() {
            showResult('demo-results', 'ğŸ§­ æµ‹è¯•åœ°ç†åæ ‡è½¬æ¢...', 'info');
            
            const testLocations = [
                { name: 'åŒ—äº¬', lat: 39.9042, lng: 116.4074 },
                { name: 'ä¸Šæµ·', lat: 31.2304, lng: 121.4737 },
                { name: 'æ·±åœ³', lat: 22.5429, lng: 114.0596 },
                { name: 'å¹¿å·', lat: 23.1291, lng: 113.2644 }
            ];
            
            testLocations.forEach((loc, index) => {
                setTimeout(() => {
                    // ç®€å•çš„å¢¨å¡æ‰˜æŠ•å½±è½¬æ¢æ¨¡æ‹Ÿ
                    const x = (loc.lng + 180) * (256 / 360);
                    const y = (1 - Math.log(Math.tan(loc.lat * Math.PI / 180) + 1 / Math.cos(loc.lat * Math.PI / 180)) / Math.PI) / 2 * 256;
                    
                    showResult('demo-results', `ğŸŒ ${loc.name}: (${loc.lat}, ${loc.lng}) â†’ (${x.toFixed(2)}, ${y.toFixed(2)})`, 'success');
                }, index * 200);
            });
        }

        // åˆå§‹åŒ–ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        function initSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            statusDiv.innerHTML = '';
            
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            const checks = [
                { name: 'WebGL æ”¯æŒ', test: () => !!window.WebGLRenderingContext },
                { name: 'Canvas æ”¯æŒ', test: () => !!document.createElement('canvas').getContext },
                { name: 'Fetch API', test: () => !!window.fetch },
                { name: 'ES6 æ”¯æŒ', test: () => { try { eval('() => {}'); return true; } catch(e) { return false; } } },
                { name: 'localStorage', test: () => !!window.localStorage },
                { name: 'è®¾å¤‡åƒç´ æ¯”', test: () => window.devicePixelRatio || 1, value: true }
            ];
            
            checks.forEach(check => {
                const result = check.test();
                const type = result ? 'success' : 'error';
                const message = check.value ? 
                    `âœ… ${check.name}: ${result}` : 
                    `${result ? 'âœ…' : 'âŒ'} ${check.name}: ${result ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`;
                
                showResult('system-status', message, type);
            });
            
            showResult('system-status', `ğŸŒ ç”¨æˆ·ä»£ç†: ${navigator.userAgent.substring(0, 80)}...`, 'info');
            showResult('system-status', `ğŸ“± å±å¹•åˆ†è¾¨ç‡: ${screen.width}x${screen.height}`, 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            initSystemStatus();
            showResult('system-status', 'ğŸš€ ç³»ç»Ÿæ£€æŸ¥å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'success');
        });
    </script>
</body>
</html>