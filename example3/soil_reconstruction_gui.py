"""
ç‹¬ç«‹æ¡Œé¢ç‰ˆä¸‰ç»´åœŸä½“é‡å»ºç¨‹åº
åŸºäºRBFæ’å€¼å’ŒGemPyçš„åœŸä½“åŸŸå»ºæ¨¡ç³»ç»Ÿ
"""
import tkinter as tk
from tkinter import ttk, filedialog, messagebox
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
from matplotlib.figure import Figure
import pyvista as pv
import pyvistaqt as pvqt
from threading import Thread
import os
import json
from typing import Dict, Tuple, Optional, List

# å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—
from rbf_interpolation import BoreholeRBFInterpolator, create_sample_borehole_data

class SoilReconstructionGUI:
    """ä¸‰ç»´åœŸä½“é‡å»ºæ¡Œé¢åº”ç”¨ç¨‹åº"""
    
    def __init__(self, root):
        self.root = root
        self.setup_gui()
        self.initialize_variables()
        
    def setup_gui(self):
        """è®¾ç½®GUIç•Œé¢"""
        self.root.title("ğŸ—ºï¸ ä¸‰ç»´åœŸä½“é‡å»ºç³»ç»Ÿ v1.0")
        self.root.geometry("1200x800")
        self.root.configure(bg='#f0f0f0')
        
        # è®¾ç½®æ ·å¼
        style = ttk.Style()
        style.theme_use('clam')
        
        # åˆ›å»ºä¸»æ¡†æ¶
        self.create_main_layout()
        
    def create_main_layout(self):
        """åˆ›å»ºä¸»å¸ƒå±€"""
        # é¡¶éƒ¨æ ‡é¢˜
        title_frame = tk.Frame(self.root, bg='#2c3e50', height=60)
        title_frame.pack(fill='x', padx=5, pady=5)
        title_frame.pack_propagate(False)
        
        title_label = tk.Label(
            title_frame, 
            text="ğŸ—ºï¸ ä¸‰ç»´åœŸä½“é‡å»ºç³»ç»Ÿ",
            font=('Arial', 18, 'bold'),
            fg='white', bg='#2c3e50'
        )
        title_label.pack(expand=True)
        
        # ä¸»é¢æ¿
        main_paned = ttk.PanedWindow(self.root, orient='horizontal')
        main_paned.pack(fill='both', expand=True, padx=5, pady=5)
        
        # å·¦ä¾§æ§åˆ¶é¢æ¿
        self.create_control_panel(main_paned)
        
        # å³ä¾§æ˜¾ç¤ºé¢æ¿
        self.create_display_panel(main_paned)
        
        # åº•éƒ¨çŠ¶æ€æ 
        self.create_status_bar()
        
    def create_control_panel(self, parent):
        """åˆ›å»ºå·¦ä¾§æ§åˆ¶é¢æ¿"""
        control_frame = ttk.Frame(parent)
        parent.add(control_frame, weight=1)
        
        # åˆ›å»ºnotebook
        notebook = ttk.Notebook(control_frame)
        notebook.pack(fill='both', expand=True, padx=5, pady=5)
        
        # åœŸä½“åŸŸè®¾ç½®é¡µé¢
        self.create_domain_tab(notebook)
        
        # é’»å­”æ•°æ®é¡µé¢
        self.create_borehole_tab(notebook)
        
        # RBFå‚æ•°é¡µé¢
        self.create_rbf_tab(notebook)
        
        # é‡å»ºè®¾ç½®é¡µé¢
        self.create_reconstruction_tab(notebook)
        
    def create_domain_tab(self, parent):
        """åˆ›å»ºåœŸä½“åŸŸè®¾ç½®é¡µé¢"""
        domain_frame = ttk.Frame(parent)
        parent.add(domain_frame, text="ğŸ—ï¸ åœŸä½“åŸŸè®¾ç½®")
        
        # Xæ–¹å‘è®¾ç½®
        x_frame = ttk.LabelFrame(domain_frame, text="Xæ–¹å‘ (m)", padding="10")
        x_frame.pack(fill='x', padx=5, pady=5)
        
        ttk.Label(x_frame, text="æœ€å°å€¼:").grid(row=0, column=0, sticky='w', padx=5)
        self.x_min_var = tk.DoubleVar(value=0.0)\n        x_min_entry = ttk.Entry(x_frame, textvariable=self.x_min_var, width=15)\n        x_min_entry.grid(row=0, column=1, padx=5)\n        \n        ttk.Label(x_frame, text=\"æœ€å¤§å€¼:\").grid(row=0, column=2, sticky='w', padx=5)\n        self.x_max_var = tk.DoubleVar(value=100.0)\n        x_max_entry = ttk.Entry(x_frame, textvariable=self.x_max_var, width=15)\n        x_max_entry.grid(row=0, column=3, padx=5)\n        \n        ttk.Label(x_frame, text=\"ç½‘æ ¼æ•°:\").grid(row=1, column=0, sticky='w', padx=5)\n        self.x_res_var = tk.IntVar(value=50)\n        x_res_spin = ttk.Spinbox(x_frame, from_=10, to=200, textvariable=self.x_res_var, width=15)\n        x_res_spin.grid(row=1, column=1, padx=5)\n        \n        # Yæ–¹å‘è®¾ç½®\n        y_frame = ttk.LabelFrame(domain_frame, text=\"Yæ–¹å‘ (m)\", padding=\"10\")\n        y_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Label(y_frame, text=\"æœ€å°å€¼:\").grid(row=0, column=0, sticky='w', padx=5)\n        self.y_min_var = tk.DoubleVar(value=0.0)\n        y_min_entry = ttk.Entry(y_frame, textvariable=self.y_min_var, width=15)\n        y_min_entry.grid(row=0, column=1, padx=5)\n        \n        ttk.Label(y_frame, text=\"æœ€å¤§å€¼:\").grid(row=0, column=2, sticky='w', padx=5)\n        self.y_max_var = tk.DoubleVar(value=100.0)\n        y_max_entry = ttk.Entry(y_frame, textvariable=self.y_max_var, width=15)\n        y_max_entry.grid(row=0, column=3, padx=5)\n        \n        ttk.Label(y_frame, text=\"ç½‘æ ¼æ•°:\").grid(row=1, column=0, sticky='w', padx=5)\n        self.y_res_var = tk.IntVar(value=50)\n        y_res_spin = ttk.Spinbox(y_frame, from_=10, to=200, textvariable=self.y_res_var, width=15)\n        y_res_spin.grid(row=1, column=1, padx=5)\n        \n        # Zæ–¹å‘è®¾ç½®\n        z_frame = ttk.LabelFrame(domain_frame, text=\"Zæ–¹å‘ (m)\", padding=\"10\")\n        z_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Label(z_frame, text=\"æœ€å°å€¼:\").grid(row=0, column=0, sticky='w', padx=5)\n        self.z_min_var = tk.DoubleVar(value=0.0)\n        z_min_entry = ttk.Entry(z_frame, textvariable=self.z_min_var, width=15)\n        z_min_entry.grid(row=0, column=1, padx=5)\n        \n        ttk.Label(z_frame, text=\"æœ€å¤§å€¼:\").grid(row=0, column=2, sticky='w', padx=5)\n        self.z_max_var = tk.DoubleVar(value=50.0)\n        z_max_entry = ttk.Entry(z_frame, textvariable=self.z_max_var, width=15)\n        z_max_entry.grid(row=0, column=3, padx=5)\n        \n        ttk.Label(z_frame, text=\"ç½‘æ ¼æ•°:\").grid(row=1, column=0, sticky='w', padx=5)\n        self.z_res_var = tk.IntVar(value=25)\n        z_res_spin = ttk.Spinbox(z_frame, from_=10, to=100, textvariable=self.z_res_var, width=15)\n        z_res_spin.grid(row=1, column=1, padx=5)\n        \n        # å¿«æ·è®¾ç½®\n        quick_frame = ttk.LabelFrame(domain_frame, text=\"å¿«æ·è®¾ç½®\", padding=\"10\")\n        quick_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Button(quick_frame, text=\"å°å‹åŸºå‘ (50x50x20m)\", \n                  command=lambda: self.set_domain_preset(50, 50, 20)).pack(side='left', padx=5)\n        ttk.Button(quick_frame, text=\"ä¸­å‹åŸºå‘ (100x100x30m)\", \n                  command=lambda: self.set_domain_preset(100, 100, 30)).pack(side='left', padx=5)\n        ttk.Button(quick_frame, text=\"å¤§å‹åŸºå‘ (200x200x50m)\", \n                  command=lambda: self.set_domain_preset(200, 200, 50)).pack(side='left', padx=5)\n        \n        # åŸŸä¿¡æ¯æ˜¾ç¤º\n        info_frame = ttk.LabelFrame(domain_frame, text=\"åŸŸä¿¡æ¯\", padding=\"10\")\n        info_frame.pack(fill='x', padx=5, pady=5)\n        \n        self.domain_info_var = tk.StringVar()\n        info_label = ttk.Label(info_frame, textvariable=self.domain_info_var, font=('Arial', 9))\n        info_label.pack()\n        \n        self.update_domain_info()\n        \n    def create_borehole_tab(self, parent):\n        \"\"\"åˆ›å»ºé’»å­”æ•°æ®é¡µé¢\"\"\"\n        borehole_frame = ttk.Frame(parent)\n        parent.add(borehole_frame, text=\"ğŸ•³ï¸ é’»å­”æ•°æ®\")\n        \n        # æ•°æ®æ¥æºé€‰æ‹©\n        source_frame = ttk.LabelFrame(borehole_frame, text=\"æ•°æ®æ¥æº\", padding=\"10\")\n        source_frame.pack(fill='x', padx=5, pady=5)\n        \n        self.data_source_var = tk.StringVar(value=\"ç¤ºä¾‹æ•°æ®\")\n        \n        ttk.Radiobutton(source_frame, text=\"ç”Ÿæˆç¤ºä¾‹æ•°æ®\", variable=self.data_source_var, \n                       value=\"ç¤ºä¾‹æ•°æ®\").pack(anchor='w')\n        ttk.Radiobutton(source_frame, text=\"å¯¼å…¥CSVæ–‡ä»¶\", variable=self.data_source_var, \n                       value=\"CSVæ–‡ä»¶\").pack(anchor='w')\n        \n        # ç¤ºä¾‹æ•°æ®è®¾ç½®\n        sample_frame = ttk.LabelFrame(borehole_frame, text=\"ç¤ºä¾‹æ•°æ®è®¾ç½®\", padding=\"10\")\n        sample_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Label(sample_frame, text=\"å¯†é›†åŒºåŸŸç‚¹æ•°:\").grid(row=0, column=0, sticky='w', padx=5)\n        self.dense_points_var = tk.IntVar(value=20)\n        ttk.Spinbox(sample_frame, from_=5, to=100, textvariable=self.dense_points_var, \n                   width=10).grid(row=0, column=1, padx=5)\n        \n        ttk.Label(sample_frame, text=\"ç¨€ç–åŒºåŸŸç‚¹æ•°:\").grid(row=0, column=2, sticky='w', padx=5)\n        self.sparse_points_var = tk.IntVar(value=15)\n        ttk.Spinbox(sample_frame, from_=5, to=50, textvariable=self.sparse_points_var, \n                   width=10).grid(row=0, column=3, padx=5)\n        \n        ttk.Label(sample_frame, text=\"å™ªå£°æ°´å¹³:\").grid(row=1, column=0, sticky='w', padx=5)\n        self.noise_var = tk.DoubleVar(value=1.0)\n        ttk.Scale(sample_frame, from_=0.1, to=3.0, variable=self.noise_var, \n                 orient='horizontal', length=100).grid(row=1, column=1, padx=5)\n        \n        # æ–‡ä»¶æ“ä½œ\n        file_frame = ttk.LabelFrame(borehole_frame, text=\"æ–‡ä»¶æ“ä½œ\", padding=\"10\")\n        file_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Button(file_frame, text=\"ğŸ“ å¯¼å…¥CSV\", command=self.load_csv_data).pack(side='left', padx=5)\n        ttk.Button(file_frame, text=\"ğŸ’¾ å¯¼å‡ºæ•°æ®\", command=self.export_data).pack(side='left', padx=5)\n        ttk.Button(file_frame, text=\"ğŸ² ç”Ÿæˆç¤ºä¾‹\", command=self.generate_sample_data).pack(side='left', padx=5)\n        \n        # æ•°æ®ä¿¡æ¯\n        self.data_info_var = tk.StringVar(value=\"æš‚æ— æ•°æ®\")\n        ttk.Label(borehole_frame, textvariable=self.data_info_var, \n                 font=('Arial', 10, 'italic')).pack(pady=5)\n        \n    def create_rbf_tab(self, parent):\n        \"\"\"åˆ›å»ºRBFå‚æ•°é¡µé¢\"\"\"\n        rbf_frame = ttk.Frame(parent)\n        parent.add(rbf_frame, text=\"ğŸ”§ RBFå‚æ•°\")\n        \n        # æ ¸å‡½æ•°è®¾ç½®\n        kernel_frame = ttk.LabelFrame(rbf_frame, text=\"æ ¸å‡½æ•°è®¾ç½®\", padding=\"10\")\n        kernel_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Label(kernel_frame, text=\"æ ¸å‡½æ•°ç±»å‹:\").grid(row=0, column=0, sticky='w', padx=5)\n        self.kernel_var = tk.StringVar(value=\"multiquadric\")\n        kernel_combo = ttk.Combobox(kernel_frame, textvariable=self.kernel_var, width=20)\n        kernel_combo['values'] = ('multiquadric', 'gaussian', 'thin_plate_spline', \n                                 'linear', 'cubic', 'quintic')\n        kernel_combo.grid(row=0, column=1, padx=5)\n        \n        # Epsilonå‚æ•°\n        epsilon_frame = ttk.LabelFrame(rbf_frame, text=\"Epsilonè®¾ç½®\", padding=\"10\")\n        epsilon_frame.pack(fill='x', padx=5, pady=5)\n        \n        self.epsilon_auto_var = tk.BooleanVar(value=True)\n        ttk.Checkbutton(epsilon_frame, text=\"è‡ªåŠ¨ä¼˜åŒ–\", \n                       variable=self.epsilon_auto_var).pack(anchor='w')\n        \n        epsilon_manual_frame = tk.Frame(epsilon_frame)\n        epsilon_manual_frame.pack(fill='x', pady=5)\n        \n        ttk.Label(epsilon_manual_frame, text=\"æ‰‹åŠ¨å€¼:\").pack(side='left', padx=5)\n        self.epsilon_var = tk.DoubleVar(value=1.0)\n        ttk.Scale(epsilon_manual_frame, from_=0.001, to=10.0, variable=self.epsilon_var, \n                 orient='horizontal', length=200).pack(side='left', padx=5)\n        \n        # å…¶ä»–å‚æ•°\n        other_frame = ttk.LabelFrame(rbf_frame, text=\"å…¶ä»–å‚æ•°\", padding=\"10\")\n        other_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Label(other_frame, text=\"å¹³æ»‘å‚æ•°:\").grid(row=0, column=0, sticky='w', padx=5)\n        self.smoothing_var = tk.DoubleVar(value=0.0)\n        ttk.Scale(other_frame, from_=0.0, to=1.0, variable=self.smoothing_var, \n                 orient='horizontal', length=150).grid(row=0, column=1, padx=5)\n        \n        self.use_polynomial_var = tk.BooleanVar(value=False)\n        ttk.Checkbutton(other_frame, text=\"ä½¿ç”¨å¤šé¡¹å¼è¶‹åŠ¿\", \n                       variable=self.use_polynomial_var).grid(row=1, column=0, columnspan=2, sticky='w')\n        \n    def create_reconstruction_tab(self, parent):\n        \"\"\"åˆ›å»ºé‡å»ºè®¾ç½®é¡µé¢\"\"\"\n        recon_frame = ttk.Frame(parent)\n        parent.add(recon_frame, text=\"ğŸ—ï¸ é‡å»ºè®¾ç½®\")\n        \n        # é‡å»ºæ–¹æ³•\n        method_frame = ttk.LabelFrame(recon_frame, text=\"é‡å»ºæ–¹æ³•\", padding=\"10\")\n        method_frame.pack(fill='x', padx=5, pady=5)\n        \n        self.recon_method_var = tk.StringVar(value=\"RBFæ’å€¼\")\n        ttk.Radiobutton(method_frame, text=\"RBFæ’å€¼é‡å»º\", variable=self.recon_method_var, \n                       value=\"RBFæ’å€¼\").pack(anchor='w')\n        ttk.Radiobutton(method_frame, text=\"GemPyåœ°è´¨å»ºæ¨¡\", variable=self.recon_method_var, \n                       value=\"GemPyå»ºæ¨¡\").pack(anchor='w')\n        ttk.Radiobutton(method_frame, text=\"æ··åˆå»ºæ¨¡\", variable=self.recon_method_var, \n                       value=\"æ··åˆå»ºæ¨¡\").pack(anchor='w')\n        \n        # æ¸²æŸ“è®¾ç½®\n        render_frame = ttk.LabelFrame(recon_frame, text=\"æ¸²æŸ“è®¾ç½®\", padding=\"10\")\n        render_frame.pack(fill='x', padx=5, pady=5)\n        \n        ttk.Label(render_frame, text=\"æ¸²æŸ“æ¨¡å¼:\").grid(row=0, column=0, sticky='w', padx=5)\n        self.render_mode_var = tk.StringVar(value=\"ä½“ç§¯æ¸²æŸ“\")\n        render_combo = ttk.Combobox(render_frame, textvariable=self.render_mode_var, width=15)\n        render_combo['values'] = ('ä½“ç§¯æ¸²æŸ“', 'ç­‰å€¼é¢', 'åˆ‡ç‰‡', 'è½®å»“')\n        render_combo.grid(row=0, column=1, padx=5)\n        \n        self.show_points_var = tk.BooleanVar(value=True)\n        ttk.Checkbutton(render_frame, text=\"æ˜¾ç¤ºé’»å­”ç‚¹\", \n                       variable=self.show_points_var).grid(row=1, column=0, columnspan=2, sticky='w')\n        \n        # æ‰§è¡ŒæŒ‰é’®\n        action_frame = ttk.Frame(recon_frame)\n        action_frame.pack(fill='x', padx=5, pady=20)\n        \n        ttk.Button(action_frame, text=\"ğŸš€ å¼€å§‹é‡å»º\", command=self.start_reconstruction, \n                  style='Accent.TButton').pack(pady=10)\n        \n        ttk.Button(action_frame, text=\"ğŸ“Š æ˜¾ç¤ºç»“æœ\", command=self.show_3d_result).pack(pady=5)\n        \n    def create_display_panel(self, parent):\n        \"\"\"åˆ›å»ºå³ä¾§æ˜¾ç¤ºé¢æ¿\"\"\"\n        display_frame = ttk.Frame(parent)\n        parent.add(display_frame, weight=2)\n        \n        # åˆ›å»ºæ˜¾ç¤ºé€‰é¡¹å¡\n        display_notebook = ttk.Notebook(display_frame)\n        display_notebook.pack(fill='both', expand=True, padx=5, pady=5)\n        \n        # 2Dé¢„è§ˆé¡µé¢\n        self.create_2d_preview_tab(display_notebook)\n        \n        # 3Dæ˜¾ç¤ºé¡µé¢\n        self.create_3d_display_tab(display_notebook)\n        \n        # ç»Ÿè®¡ä¿¡æ¯é¡µé¢\n        self.create_stats_tab(display_notebook)\n        \n    def create_2d_preview_tab(self, parent):\n        \"\"\"åˆ›å»º2Dé¢„è§ˆé¡µé¢\"\"\"\n        preview_frame = ttk.Frame(parent)\n        parent.add(preview_frame, text=\"ğŸ“Š 2Dé¢„è§ˆ\")\n        \n        # åˆ›å»ºmatplotlibå›¾å½¢\n        self.fig_2d = Figure(figsize=(8, 6), dpi=100)\n        self.canvas_2d = FigureCanvasTkAgg(self.fig_2d, preview_frame)\n        self.canvas_2d.get_tk_widget().pack(fill='both', expand=True)\n        \n        # å·¥å…·æ \n        toolbar_frame = tk.Frame(preview_frame)\n        toolbar_frame.pack(fill='x')\n        \n        ttk.Button(toolbar_frame, text=\"ğŸ”„ åˆ·æ–°\", command=self.update_2d_preview).pack(side='left', padx=5)\n        ttk.Button(toolbar_frame, text=\"ğŸ’¾ ä¿å­˜å›¾ç‰‡\", command=self.save_2d_plot).pack(side='left', padx=5)\n        \n    def create_3d_display_tab(self, parent):\n        \"\"\"åˆ›å»º3Dæ˜¾ç¤ºé¡µé¢\"\"\"\n        display_3d_frame = ttk.Frame(parent)\n        parent.add(display_3d_frame, text=\"ğŸ¯ 3Dæ˜¾ç¤º\")\n        \n        # 3Dæ˜¾ç¤ºæç¤º\n        info_label = ttk.Label(display_3d_frame, \n                              text=\"3Då¯è§†åŒ–å°†åœ¨ç‹¬ç«‹çª—å£ä¸­æ˜¾ç¤º\\nç‚¹å‡»'æ˜¾ç¤ºç»“æœ'æŒ‰é’®æŸ¥çœ‹ä¸‰ç»´æ¨¡å‹\", \n                              font=('Arial', 12), \n                              justify='center')\n        info_label.pack(expand=True)\n        \n        # 3Dæ§åˆ¶æŒ‰é’®\n        control_3d_frame = tk.Frame(display_3d_frame)\n        control_3d_frame.pack(pady=20)\n        \n        ttk.Button(control_3d_frame, text=\"ğŸ¯ æ‰“å¼€3Dè§†å›¾\", \n                  command=self.show_3d_result).pack(pady=5)\n        ttk.Button(control_3d_frame, text=\"ğŸ“· ä¿å­˜3Dæˆªå›¾\", \n                  command=self.save_3d_screenshot).pack(pady=5)\n        \n    def create_stats_tab(self, parent):\n        \"\"\"åˆ›å»ºç»Ÿè®¡ä¿¡æ¯é¡µé¢\"\"\"\n        stats_frame = ttk.Frame(parent)\n        parent.add(stats_frame, text=\"ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯\")\n        \n        # åˆ›å»ºæ–‡æœ¬æ¡†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯\n        self.stats_text = tk.Text(stats_frame, wrap='word', font=('Consolas', 10))\n        scrollbar = ttk.Scrollbar(stats_frame, orient='vertical', command=self.stats_text.yview)\n        self.stats_text.configure(yscrollcommand=scrollbar.set)\n        \n        self.stats_text.pack(side='left', fill='both', expand=True)\n        scrollbar.pack(side='right', fill='y')\n        \n    def create_status_bar(self):\n        \"\"\"åˆ›å»ºçŠ¶æ€æ \"\"\"\n        self.status_bar = tk.Frame(self.root, relief='sunken', bd=1, bg='#e0e0e0')\n        self.status_bar.pack(side='bottom', fill='x')\n        \n        self.status_var = tk.StringVar(value=\"å°±ç»ª\")\n        status_label = tk.Label(self.status_bar, textvariable=self.status_var, \n                               bg='#e0e0e0', anchor='w')\n        status_label.pack(side='left', padx=5)\n        \n        # è¿›åº¦æ¡\n        self.progress = ttk.Progressbar(self.status_bar, length=200, mode='determinate')\n        self.progress.pack(side='right', padx=5, pady=2)\n        \n    def initialize_variables(self):\n        \"\"\"åˆå§‹åŒ–å˜é‡\"\"\"\n        self.coords = None\n        self.values = None\n        self.interpolator = None\n        self.reconstruction_result = None\n        self.pit_bounds = None\n        \n        # ç»‘å®šäº‹ä»¶\n        for var in [self.x_min_var, self.x_max_var, self.x_res_var,\n                   self.y_min_var, self.y_max_var, self.y_res_var,\n                   self.z_min_var, self.z_max_var, self.z_res_var]:\n            var.trace('w', lambda *args: self.update_domain_info())\n            \n    def set_domain_preset(self, x_size, y_size, z_size):\n        \"\"\"è®¾ç½®åŸŸé¢„è®¾å€¼\"\"\"\n        self.x_min_var.set(0)\n        self.x_max_var.set(x_size)\n        self.y_min_var.set(0)\n        self.y_max_var.set(y_size)\n        self.z_min_var.set(0)\n        self.z_max_var.set(z_size)\n        \n        # æ ¹æ®åŸŸå¤§å°è°ƒæ•´ç½‘æ ¼åˆ†è¾¨ç‡\n        self.x_res_var.set(min(100, max(20, x_size // 2)))\n        self.y_res_var.set(min(100, max(20, y_size // 2)))\n        self.z_res_var.set(min(50, max(10, z_size // 2)))\n        \n    def update_domain_info(self):\n        \"\"\"æ›´æ–°åŸŸä¿¡æ¯æ˜¾ç¤º\"\"\"\n        try:\n            x_range = self.x_max_var.get() - self.x_min_var.get()\n            y_range = self.y_max_var.get() - self.y_min_var.get()\n            z_range = self.z_max_var.get() - self.z_min_var.get()\n            \n            volume = x_range * y_range * z_range\n            total_points = self.x_res_var.get() * self.y_res_var.get() * self.z_res_var.get()\n            \n            info_text = (f\"åŸŸå¤§å°: {x_range:.1f} Ã— {y_range:.1f} Ã— {z_range:.1f} mÂ³\\n\"\n                        f\"ä½“ç§¯: {volume:,.0f} mÂ³\\n\"\n                        f\"ç½‘æ ¼ç‚¹æ•°: {total_points:,} ä¸ª\")\n            \n            self.domain_info_var.set(info_text)\n        except:\n            self.domain_info_var.set(\"åŸŸå‚æ•°è®¾ç½®æœ‰è¯¯\")\n            \n    def generate_sample_data(self):\n        \"\"\"ç”Ÿæˆç¤ºä¾‹æ•°æ®\"\"\"\n        try:\n            self.status_var.set(\"æ­£åœ¨ç”Ÿæˆç¤ºä¾‹æ•°æ®...\")\n            self.progress['value'] = 20\n            self.root.update()\n            \n            # è·å–åŸºå‘è¾¹ç•Œï¼ˆåŸŸçš„ä¸­å¿ƒ40%åŒºåŸŸä½œä¸ºå¯†é›†åŒºåŸŸï¼‰\n            x_center = (self.x_min_var.get() + self.x_max_var.get()) / 2\n            y_center = (self.y_min_var.get() + self.y_max_var.get()) / 2\n            x_range = (self.x_max_var.get() - self.x_min_var.get()) * 0.4\n            y_range = (self.y_max_var.get() - self.y_min_var.get()) * 0.4\n            \n            self.pit_bounds = {\n                'x': (x_center - x_range/2, x_center + x_range/2),\n                'y': (y_center - y_range/2, y_center + y_range/2)\n            }\n            \n            self.progress['value'] = 50\n            self.root.update()\n            \n            # ç”Ÿæˆæ•°æ®\n            self.coords, self.values, _ = create_sample_borehole_data(\n                n_dense=self.dense_points_var.get(),\n                n_sparse=self.sparse_points_var.get(),\n                pit_bounds=self.pit_bounds\n            )\n            \n            # ç¼©æ”¾åˆ°å®é™…åŸŸå¤§å°\n            self.coords[:, 0] = np.interp(self.coords[:, 0], [0, 100], \n                                         [self.x_min_var.get(), self.x_max_var.get()])\n            self.coords[:, 1] = np.interp(self.coords[:, 1], [0, 100], \n                                         [self.y_min_var.get(), self.y_max_var.get()])\n            \n            # æ·»åŠ å™ªå£°\n            self.values += np.random.normal(0, self.noise_var.get(), len(self.values))\n            \n            self.progress['value'] = 100\n            self.root.update()\n            \n            # æ›´æ–°ä¿¡æ¯æ˜¾ç¤º\n            info_text = (f\"æ•°æ®ç‚¹æ€»æ•°: {len(self.coords)}\\n\"\n                        f\"XèŒƒå›´: {self.coords[:, 0].min():.1f} ~ {self.coords[:, 0].max():.1f} m\\n\"\n                        f\"YèŒƒå›´: {self.coords[:, 1].min():.1f} ~ {self.coords[:, 1].max():.1f} m\\n\"\n                        f\"å€¼èŒƒå›´: {self.values.min():.2f} ~ {self.values.max():.2f}\")\n            self.data_info_var.set(info_text)\n            \n            # æ›´æ–°2Dé¢„è§ˆ\n            self.update_2d_preview()\n            \n            self.status_var.set(\"ç¤ºä¾‹æ•°æ®ç”Ÿæˆå®Œæˆ\")\n            self.progress['value'] = 0\n            \n        except Exception as e:\n            messagebox.showerror(\"é”™è¯¯\", f\"ç”Ÿæˆç¤ºä¾‹æ•°æ®å¤±è´¥: {str(e)}\")\n            self.status_var.set(\"ç”Ÿæˆæ•°æ®å¤±è´¥\")\n            self.progress['value'] = 0\n            \n    def load_csv_data(self):\n        \"\"\"åŠ è½½CSVæ•°æ®æ–‡ä»¶\"\"\"\n        try:\n            file_path = filedialog.askopenfilename(\n                title=\"é€‰æ‹©CSVæ–‡ä»¶\",\n                filetypes=[(\"CSVæ–‡ä»¶\", \"*.csv\"), (\"æ‰€æœ‰æ–‡ä»¶\", \"*.*\")]\n            )\n            \n            if not file_path:\n                return\n                \n            self.status_var.set(\"æ­£åœ¨åŠ è½½æ•°æ®æ–‡ä»¶...\")\n            self.progress['value'] = 30\n            self.root.update()\n            \n            # è¯»å–CSVæ–‡ä»¶\n            df = pd.read_csv(file_path)\n            \n            # æ£€æŸ¥å¿…éœ€åˆ—\n            required_cols = ['x', 'y', 'value']\n            if not all(col in df.columns for col in required_cols):\n                messagebox.showerror(\"é”™è¯¯\", f\"CSVæ–‡ä»¶å¿…é¡»åŒ…å«åˆ—: {required_cols}\")\n                return\n                \n            self.progress['value'] = 70\n            self.root.update()\n            \n            # æå–æ•°æ®\n            if 'z' in df.columns:\n                self.coords = df[['x', 'y', 'z']].values\n            else:\n                self.coords = df[['x', 'y']].values\n            self.values = df['value'].values\n            \n            self.progress['value'] = 100\n            self.root.update()\n            \n            # æ›´æ–°ä¿¡æ¯æ˜¾ç¤º\n            info_text = (f\"æ•°æ®ç‚¹æ€»æ•°: {len(self.coords)}\\n\"\n                        f\"XèŒƒå›´: {self.coords[:, 0].min():.1f} ~ {self.coords[:, 0].max():.1f} m\\n\"\n                        f\"YèŒƒå›´: {self.coords[:, 1].min():.1f} ~ {self.coords[:, 1].max():.1f} m\\n\"\n                        f\"å€¼èŒƒå›´: {self.values.min():.2f} ~ {self.values.max():.2f}\")\n            self.data_info_var.set(info_text)\n            \n            # æ›´æ–°2Dé¢„è§ˆ\n            self.update_2d_preview()\n            \n            self.status_var.set(f\"æˆåŠŸåŠ è½½ {len(self.coords)} ä¸ªæ•°æ®ç‚¹\")\n            self.progress['value'] = 0\n            \n        except Exception as e:\n            messagebox.showerror(\"é”™è¯¯\", f\"åŠ è½½æ•°æ®æ–‡ä»¶å¤±è´¥: {str(e)}\")\n            self.status_var.set(\"åŠ è½½æ•°æ®å¤±è´¥\")\n            self.progress['value'] = 0\n            \n    def export_data(self):\n        \"\"\"å¯¼å‡ºæ•°æ®\"\"\"\n        if self.coords is None or self.values is None:\n            messagebox.showwarning(\"è­¦å‘Š\", \"æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®\")\n            return\n            \n        try:\n            file_path = filedialog.asksaveasfilename(\n                title=\"ä¿å­˜æ•°æ®æ–‡ä»¶\",\n                defaultextension=\".csv\",\n                filetypes=[(\"CSVæ–‡ä»¶\", \"*.csv\"), (\"æ‰€æœ‰æ–‡ä»¶\", \"*.*\")]\n            )\n            \n            if not file_path:\n                return\n                \n            # åˆ›å»ºDataFrame\n            df = pd.DataFrame({\n                'x': self.coords[:, 0],\n                'y': self.coords[:, 1],\n                'value': self.values\n            })\n            \n            if self.coords.shape[1] == 3:\n                df['z'] = self.coords[:, 2]\n                \n            df.to_csv(file_path, index=False)\n            \n            messagebox.showinfo(\"æˆåŠŸ\", f\"æ•°æ®å·²ä¿å­˜åˆ°: {file_path}\")\n            self.status_var.set(\"æ•°æ®å¯¼å‡ºå®Œæˆ\")\n            \n        except Exception as e:\n            messagebox.showerror(\"é”™è¯¯\", f\"å¯¼å‡ºæ•°æ®å¤±è´¥: {str(e)}\")\n            \n    def update_2d_preview(self):\n        \"\"\"æ›´æ–°2Dé¢„è§ˆå›¾\"\"\"\n        if self.coords is None or self.values is None:\n            return\n            \n        try:\n            self.fig_2d.clear()\n            \n            # åˆ›å»ºå­å›¾\n            ax1 = self.fig_2d.add_subplot(121)\n            ax2 = self.fig_2d.add_subplot(122)\n            \n            # æ•°æ®åˆ†å¸ƒå›¾\n            scatter = ax1.scatter(self.coords[:, 0], self.coords[:, 1], \n                                c=self.values, cmap='viridis', s=50, alpha=0.7)\n            ax1.set_xlabel('Xåæ ‡ (m)')\n            ax1.set_ylabel('Yåæ ‡ (m)')\n            ax1.set_title('é’»å­”æ•°æ®åˆ†å¸ƒ')\n            ax1.grid(True, alpha=0.3)\n            \n            # æ·»åŠ åŸºå‘è¾¹ç•Œ\n            if self.pit_bounds:\n                x_bounds = self.pit_bounds['x']\n                y_bounds = self.pit_bounds['y']\n                ax1.add_patch(plt.Rectangle((x_bounds[0], y_bounds[0]), \n                                          x_bounds[1] - x_bounds[0],\n                                          y_bounds[1] - y_bounds[0],\n                                          fill=False, edgecolor='red', \n                                          linewidth=2, linestyle='--'))\n                ax1.text((x_bounds[0] + x_bounds[1])/2, y_bounds[1], \n                        'åŸºå‘åŒºåŸŸ', ha='center', color='red', fontweight='bold')\n            \n            self.fig_2d.colorbar(scatter, ax=ax1, label='å€¼')\n            \n            # å€¼åˆ†å¸ƒç›´æ–¹å›¾\n            ax2.hist(self.values, bins=20, alpha=0.7, color='skyblue', edgecolor='navy')\n            ax2.set_xlabel('å€¼')\n            ax2.set_ylabel('é¢‘æ¬¡')\n            ax2.set_title('æ•°æ®å€¼åˆ†å¸ƒ')\n            ax2.grid(True, alpha=0.3)\n            \n            self.fig_2d.tight_layout()\n            self.canvas_2d.draw()\n            \n        except Exception as e:\n            print(f\"æ›´æ–°2Dé¢„è§ˆå¤±è´¥: {e}\")\n            \n    def save_2d_plot(self):\n        \"\"\"ä¿å­˜2Då›¾ç‰‡\"\"\"\n        try:\n            file_path = filedialog.asksaveasfilename(\n                title=\"ä¿å­˜å›¾ç‰‡\",\n                defaultextension=\".png\",\n                filetypes=[(\"PNGæ–‡ä»¶\", \"*.png\"), (\"JPGæ–‡ä»¶\", \"*.jpg\"), (\"æ‰€æœ‰æ–‡ä»¶\", \"*.*\")]\n            )\n            \n            if file_path:\n                self.fig_2d.savefig(file_path, dpi=300, bbox_inches='tight')\n                messagebox.showinfo(\"æˆåŠŸ\", f\"å›¾ç‰‡å·²ä¿å­˜åˆ°: {file_path}\")\n                \n        except Exception as e:\n            messagebox.showerror(\"é”™è¯¯\", f\"ä¿å­˜å›¾ç‰‡å¤±è´¥: {str(e)}\")\n            \n    def start_reconstruction(self):\n        \"\"\"å¼€å§‹ä¸‰ç»´é‡å»º\"\"\"\n        if self.coords is None or self.values is None:\n            messagebox.showwarning(\"è­¦å‘Š\", \"è¯·å…ˆåŠ è½½æˆ–ç”Ÿæˆé’»å­”æ•°æ®\")\n            return\n            \n        try:\n            self.status_var.set(\"æ­£åœ¨è¿›è¡Œä¸‰ç»´é‡å»º...\")\n            self.progress['value'] = 10\n            self.root.update()\n            \n            # åˆ›å»ºRBFæ’å€¼å™¨\n            epsilon = 'scale' if self.epsilon_auto_var.get() else self.epsilon_var.get()\n            degree = 1 if self.use_polynomial_var.get() else None\n            \n            self.interpolator = BoreholeRBFInterpolator(\n                foundation_pit_bounds=self.pit_bounds,\n                kernel=self.kernel_var.get(),\n                epsilon=epsilon,\n                smoothing=self.smoothing_var.get(),\n                degree=degree\n            )\n            \n            self.progress['value'] = 30\n            self.root.update()\n            \n            # æ‹Ÿåˆæ’å€¼å™¨\n            self.interpolator.fit(self.coords, self.values, optimize_params=True)\n            \n            self.progress['value'] = 60\n            self.root.update()\n            \n            # åˆ›å»ºæ’å€¼ç½‘æ ¼\n            extent = [\n                self.x_min_var.get(), self.x_max_var.get(),\n                self.y_min_var.get(), self.y_max_var.get(),\n                self.z_min_var.get(), self.z_max_var.get()\n            ]\n            \n            resolution = [\n                self.x_res_var.get(),\n                self.y_res_var.get(),\n                self.z_res_var.get()\n            ]\n            \n            # ç”Ÿæˆç½‘æ ¼ç‚¹\n            x = np.linspace(extent[0], extent[1], resolution[0])\n            y = np.linspace(extent[2], extent[3], resolution[1])\n            z = np.linspace(extent[4], extent[5], resolution[2])\n            \n            xg, yg, zg = np.meshgrid(x, y, z, indexing='ij')\n            grid_coords = np.column_stack([xg.ravel(), yg.ravel(), zg.ravel()])\n            \n            self.progress['value'] = 80\n            self.root.update()\n            \n            # è¿›è¡Œæ’å€¼\n            interpolated_values = self.interpolator.predict(grid_coords[:, :2], method='adaptive')\n            interpolated_grid = interpolated_values.reshape(resolution, order='F')\n            \n            # ä¿å­˜é‡å»ºç»“æœ\n            self.reconstruction_result = {\n                'grid': interpolated_grid,\n                'extent': extent,\n                'resolution': resolution,\n                'coords': grid_coords,\n                'values': interpolated_values\n            }\n            \n            self.progress['value'] = 100\n            self.root.update()\n            \n            # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯\n            self.update_stats_display()\n            \n            self.status_var.set(\"ä¸‰ç»´é‡å»ºå®Œæˆ\")\n            self.progress['value'] = 0\n            \n            messagebox.showinfo(\"æˆåŠŸ\", \"ä¸‰ç»´åœŸä½“é‡å»ºå®Œæˆï¼\")\n            \n        except Exception as e:\n            messagebox.showerror(\"é”™è¯¯\", f\"ä¸‰ç»´é‡å»ºå¤±è´¥: {str(e)}\")\n            self.status_var.set(\"é‡å»ºå¤±è´¥\")\n            self.progress['value'] = 0\n            \n    def update_stats_display(self):\n        \"\"\"æ›´æ–°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º\"\"\"\n        if not self.reconstruction_result:\n            return\n            \n        try:\n            # è·å–é‡å»ºç»“æœç»Ÿè®¡\n            grid = self.reconstruction_result['grid']\n            extent = self.reconstruction_result['extent']\n            resolution = self.reconstruction_result['resolution']\n            \n            stats_text = f\"\"\"\n=== ä¸‰ç»´åœŸä½“é‡å»ºç»Ÿè®¡ä¿¡æ¯ ===\n\nã€åŸŸè®¾ç½®ã€‘\nXèŒƒå›´: {extent[0]:.1f} ~ {extent[1]:.1f} m\nYèŒƒå›´: {extent[2]:.1f} ~ {extent[3]:.1f} m\nZèŒƒå›´: {extent[4]:.1f} ~ {extent[5]:.1f} m\nç½‘æ ¼åˆ†è¾¨ç‡: {resolution[0]} Ã— {resolution[1]} Ã— {resolution[2]}\næ€»ç½‘æ ¼ç‚¹æ•°: {np.prod(resolution):,}\n\nã€åŸå§‹æ•°æ®ã€‘\né’»å­”æ€»æ•°: {len(self.coords)}\nXåæ ‡èŒƒå›´: {self.coords[:, 0].min():.1f} ~ {self.coords[:, 0].max():.1f} m\nYåæ ‡èŒƒå›´: {self.coords[:, 1].min():.1f} ~ {self.coords[:, 1].max():.1f} m\nè§‚æµ‹å€¼èŒƒå›´: {self.values.min():.2f} ~ {self.values.max():.2f}\nè§‚æµ‹å€¼å‡å€¼: {self.values.mean():.2f}\nè§‚æµ‹å€¼æ ‡å‡†å·®: {self.values.std():.2f}\n\nã€æ’å€¼ç»“æœã€‘\næ’å€¼æ–¹æ³•: RBF ({self.kernel_var.get()})\nEpsilonè®¾ç½®: {'è‡ªåŠ¨ä¼˜åŒ–' if self.epsilon_auto_var.get() else f'æ‰‹åŠ¨ ({self.epsilon_var.get():.3f})'}\næ’å€¼å€¼èŒƒå›´: {grid.min():.2f} ~ {grid.max():.2f}\næ’å€¼å€¼å‡å€¼: {grid.mean():.2f}\næ’å€¼å€¼æ ‡å‡†å·®: {grid.std():.2f}\n\nã€åŒºåŸŸè¯†åˆ«ã€‘\"\"\"\n            \n            if hasattr(self.interpolator, 'dense_mask') and self.interpolator.dense_mask is not None:\n                dense_count = np.sum(self.interpolator.dense_mask)\n                sparse_count = np.sum(self.interpolator.sparse_mask)\n                stats_text += f\"\"\"\nå¯†é›†åŒºåŸŸç‚¹æ•°: {dense_count}\nç¨€ç–åŒºåŸŸç‚¹æ•°: {sparse_count}\nå¯†é›†/ç¨€ç–æ¯”ä¾‹: {dense_count/sparse_count:.2f}\"\"\"\n            else:\n                stats_text += \"\\næœªè¿›è¡ŒåŒºåŸŸè¯†åˆ«\"\n                \n            # å¦‚æœæœ‰äº¤å‰éªŒè¯ç»“æœ\n            try:\n                cv_scores = self.interpolator.cross_validate(self.coords, self.values, cv_folds=5)\n                stats_text += f\"\"\"\n\nã€æ¨¡å‹æ€§èƒ½è¯„ä¼°ã€‘\nRÂ² (å†³å®šç³»æ•°): {cv_scores['R2']:.4f} Â± {cv_scores['R2_std']:.4f}\nRMSE (å‡æ–¹æ ¹è¯¯å·®): {cv_scores['RMSE']:.4f} Â± {cv_scores['RMSE_std']:.4f}\nMAE (å¹³å‡ç»å¯¹è¯¯å·®): {cv_scores['MAE']:.4f} Â± {cv_scores['MAE_std']:.4f}\"\"\"\n            except:\n                stats_text += \"\\n\\nã€æ¨¡å‹æ€§èƒ½è¯„ä¼°ã€‘\\nè¯„ä¼°è®¡ç®—ä¸­...\"\n                \n            # æ›´æ–°æ–‡æœ¬æ˜¾ç¤º\n            self.stats_text.delete(1.0, tk.END)\n            self.stats_text.insert(1.0, stats_text)\n            \n        except Exception as e:\n            print(f\"æ›´æ–°ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: {e}\")\n            \n    def show_3d_result(self):\n        \"\"\"æ˜¾ç¤º3Dç»“æœ\"\"\"\n        if not self.reconstruction_result:\n            messagebox.showwarning(\"è­¦å‘Š\", \"è¯·å…ˆå®Œæˆä¸‰ç»´é‡å»º\")\n            return\n            \n        try:\n            self.status_var.set(\"æ­£åœ¨å‡†å¤‡3Dæ˜¾ç¤º...\")\n            \n            # åœ¨æ–°çº¿ç¨‹ä¸­æ˜¾ç¤º3Dç»“æœï¼Œé¿å…é˜»å¡ä¸»ç•Œé¢\n            thread = Thread(target=self._show_3d_in_thread)\n            thread.daemon = True\n            thread.start()\n            \n        except Exception as e:\n            messagebox.showerror(\"é”™è¯¯\", f\"æ˜¾ç¤º3Dç»“æœå¤±è´¥: {str(e)}\")\n            \n    def _show_3d_in_thread(self):\n        \"\"\"åœ¨çº¿ç¨‹ä¸­æ˜¾ç¤º3Dç»“æœ\"\"\"\n        try:\n            # è·å–é‡å»ºç»“æœ\n            grid = self.reconstruction_result['grid']\n            extent = self.reconstruction_result['extent']\n            resolution = self.reconstruction_result['resolution']\n            \n            # åˆ›å»ºPyVistaç½‘æ ¼\n            x = np.linspace(extent[0], extent[1], resolution[0])\n            y = np.linspace(extent[2], extent[3], resolution[1])\n            z = np.linspace(extent[4], extent[5], resolution[2])\n            \n            mesh = pv.StructuredGrid(*np.meshgrid(x, y, z, indexing='ij'))\n            mesh['values'] = grid.ravel(order='F')\n            \n            # åˆ›å»ºPyVistaç»˜å›¾å™¨\n            plotter = pvqt.BackgroundPlotter(show=False, title=\"ä¸‰ç»´åœŸä½“é‡å»ºç»“æœ\")\n            \n            # æ ¹æ®æ¸²æŸ“æ¨¡å¼æ˜¾ç¤º\n            render_mode = self.render_mode_var.get()\n            \n            if render_mode == \"ä½“ç§¯æ¸²æŸ“\":\n                plotter.add_volume(mesh, scalars='values', opacity='linear')\n            elif render_mode == \"ç­‰å€¼é¢\":\n                # åˆ›å»ºç­‰å€¼é¢\n                contours = mesh.contour(isosurfaces=5, scalars='values')\n                plotter.add_mesh(contours, scalars='values', opacity=0.7)\n            elif render_mode == \"åˆ‡ç‰‡\":\n                # åˆ›å»ºåˆ‡ç‰‡\n                slices = mesh.slice_orthogonal()\n                plotter.add_mesh(slices, scalars='values')\n            elif render_mode == \"è½®å»“\":\n                # æ˜¾ç¤ºè½®å»“\n                edges = mesh.extract_all_edges()\n                plotter.add_mesh(edges, color='black', line_width=1)\n                plotter.add_mesh(mesh.outline(), color='red', line_width=3)\n                \n            # æ·»åŠ é’»å­”ç‚¹\n            if self.show_points_var.get():\n                points = pv.PolyData(self.coords)\n                points['values'] = self.values\n                plotter.add_mesh(points, scalars='values', point_size=10, \n                               render_points_as_spheres=True)\n                \n            # è®¾ç½®ç›¸æœºå’Œæ ·å¼\n            plotter.add_axes()\n            plotter.add_scalar_bar(title='æ’å€¼å€¼')\n            plotter.set_background('white')\n            plotter.camera_position = 'iso'\n            \n            # æ˜¾ç¤º\n            plotter.show()\n            \n            self.status_var.set(\"3Dæ˜¾ç¤ºå®Œæˆ\")\n            \n        except Exception as e:\n            print(f\"3Dæ˜¾ç¤ºå¤±è´¥: {e}\")\n            self.status_var.set(\"3Dæ˜¾ç¤ºå¤±è´¥\")\n            \n    def save_3d_screenshot(self):\n        \"\"\"ä¿å­˜3Dæˆªå›¾\"\"\"\n        messagebox.showinfo(\"æç¤º\", \"è¯·åœ¨3Dçª—å£ä¸­ä½¿ç”¨å³é”®èœå•ä¿å­˜æˆªå›¾\")\n        \n\ndef main():\n    \"\"\"ä¸»å‡½æ•°\"\"\"\n    root = tk.Tk()\n    app = SoilReconstructionGUI(root)\n    \n    try:\n        root.mainloop()\n    except KeyboardInterrupt:\n        print(\"\\nç¨‹åºå·²é€€å‡º\")\n    except Exception as e:\n        print(f\"ç¨‹åºè¿è¡Œé”™è¯¯: {e}\")\n        \nif __name__ == \"__main__\":\n    main()