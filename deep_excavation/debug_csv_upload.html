<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSVä¸Šä¼ è°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .log { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input[type="file"] { margin: 10px 0; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” CSVä¸Šä¼ å’Œ3Dç”Ÿæˆè°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h3>ğŸ“ 1. æµ‹è¯•CSVæ–‡ä»¶ä¸Šä¼ </h3>
            <input type="file" id="csvFile" accept=".csv" />
            <button onclick="testCsvUpload()">æµ‹è¯•CSVè§£æ</button>
            <div id="csvResult" class="log"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ”ï¸ 2. æµ‹è¯•åœ°è´¨æ¨¡å‹ç”Ÿæˆ</h3>
            <button onclick="testGeologicalModel()">ç”Ÿæˆæµ‹è¯•åœ°è´¨æ¨¡å‹</button>
            <div id="modelResult" class="log"></div>
        </div>
        
        <div class="section">
            <h3>ğŸŒ 3. æ£€æŸ¥å‰ç«¯è¿æ¥</h3>
            <button onclick="checkFrontend()">æ£€æŸ¥å‰ç«¯çŠ¶æ€</button>
            <div id="frontendResult" class="log"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ”§ 4. æ£€æŸ¥åç«¯è¿æ¥</h3>
            <button onclick="checkBackend()">æ£€æŸ¥åç«¯çŠ¶æ€</button>
            <div id="backendResult" class="log"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š 5. ç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š</h3>
            <button onclick="generateReport()">ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š</button>
            <div id="reportResult" class="log"></div>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        function testCsvUpload() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                log('csvResult', 'âŒ è¯·å…ˆé€‰æ‹©CSVæ–‡ä»¶', 'error');
                return;
            }
            
            log('csvResult', `ğŸ“ å¼€å§‹è§£ææ–‡ä»¶: ${file.name} (${(file.size/1024).toFixed(1)}KB)`);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csvData = e.target.result;
                    const lines = csvData.split('\n').filter(line => line.trim());
                    
                    log('csvResult', `ğŸ“Š CSVè§£ææˆåŠŸ: ${lines.length}è¡Œæ•°æ®`, 'success');
                    
                    if (lines.length > 0) {
                        const headers = lines[0].split(',').map(h => h.trim());
                        log('csvResult', `ğŸ“‹ åˆ—å: ${headers.join(', ')}`);
                        
                        // æ£€æŸ¥å¿…éœ€åˆ—
                        const required = ['X', 'Y', 'Z', 'surface'];
                        const missing = required.filter(col => !headers.includes(col));
                        
                        if (missing.length > 0) {
                            log('csvResult', `âŒ ç¼ºå°‘å¿…éœ€åˆ—: ${missing.join(', ')}`, 'error');
                        } else {
                            log('csvResult', 'âœ… CSVæ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€åˆ—', 'success');
                            
                            // ç»Ÿè®¡åœ°å±‚
                            const surfaceData = {};
                            for (let i = 1; i < Math.min(lines.length, 100); i++) {
                                const values = lines[i].split(',');
                                const surface = values[headers.indexOf('surface')]?.trim();
                                if (surface) {
                                    surfaceData[surface] = (surfaceData[surface] || 0) + 1;
                                }
                            }
                            
                            log('csvResult', `ğŸ”ï¸ æ£€æµ‹åˆ°åœ°å±‚: ${Object.keys(surfaceData).map(s => `${s}(${surfaceData[s]}ç‚¹)`).join(', ')}`);
                        }
                    }
                } catch (error) {
                    log('csvResult', `âŒ CSVè§£æå¤±è´¥: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        function testGeologicalModel() {
            log('modelResult', 'ğŸ”ï¸ å¼€å§‹æµ‹è¯•åœ°è´¨æ¨¡å‹ç”Ÿæˆ...');
            
            // æ¨¡æ‹Ÿåœ°è´¨æ¨¡å‹æ•°æ®
            const testData = {
                csvData: `X,Y,Z,surface
499300,316500,45,surface_1
499400,316600,43,surface_1
499500,316700,44,surface_1
499300,316500,35,surface_2
499400,316600,33,surface_2
499500,316700,34,surface_2`,
                layerInfo: [
                    { name: 'surface_1', pointCount: 3, avgDepth: 44 },
                    { name: 'surface_2', pointCount: 3, avgDepth: 34 }
                ]
            };
            
            try {
                log('modelResult', 'ğŸ“Š æµ‹è¯•æ•°æ®å‡†å¤‡å®Œæˆ');
                log('modelResult', `ğŸ“‹ CSVæ•°æ®: ${testData.csvData.split('\n').length}è¡Œ`);
                log('modelResult', `ğŸ”ï¸ åœ°å±‚ä¿¡æ¯: ${testData.layerInfo.length}å±‚`);
                
                // è¿™é‡Œå¯ä»¥è°ƒç”¨å®é™…çš„åœ°è´¨æ¨¡å‹ç”Ÿæˆå‡½æ•°
                log('modelResult', 'âœ… åœ°è´¨æ¨¡å‹æµ‹è¯•æ•°æ®éªŒè¯é€šè¿‡', 'success');
                log('modelResult', 'ğŸ’¡ å»ºè®®æ£€æŸ¥å‰ç«¯æ§åˆ¶å°æ˜¯å¦æœ‰è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯', 'warning');
                
            } catch (error) {
                log('modelResult', `âŒ åœ°è´¨æ¨¡å‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function checkFrontend() {
            log('frontendResult', 'ğŸŒ æ£€æŸ¥å‰ç«¯æœåŠ¡çŠ¶æ€...');
            
            try {
                const response = await fetch('http://localhost:3001/');
                if (response.ok) {
                    log('frontendResult', 'âœ… å‰ç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ (http://localhost:3001/)', 'success');
                } else {
                    log('frontendResult', `âš ï¸ å‰ç«¯å“åº”å¼‚å¸¸: ${response.status}`, 'warning');
                }
            } catch (error) {
                log('frontendResult', `âŒ å‰ç«¯è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                log('frontendResult', 'ğŸ’¡ è¯·ç¡®ä¿å‰ç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ', 'warning');
            }
        }

        async function checkBackend() {
            log('backendResult', 'ğŸ”§ æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€...');
            
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    const data = await response.json();
                    log('backendResult', 'âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ (http://localhost:8000/)', 'success');
                    log('backendResult', `ğŸ“Š åç«¯çŠ¶æ€: ${JSON.stringify(data, null, 2)}`);
                } else {
                    log('backendResult', `âš ï¸ åç«¯å“åº”å¼‚å¸¸: ${response.status}`, 'warning');
                }
            } catch (error) {
                log('backendResult', `âŒ åç«¯è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                log('backendResult', 'ğŸ’¡ è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ', 'warning');
            }
        }

        function generateReport() {
            log('reportResult', 'ğŸ“Š ç”Ÿæˆç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š...');
            log('reportResult', '=== DeepCAD Pro ç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š ===');
            log('reportResult', `ğŸ• ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}`);
            log('reportResult', '');
            
            log('reportResult', 'ğŸ” å·²çŸ¥é—®é¢˜:');
            log('reportResult', '1. CSVä¸Šä¼ åæ²¡æœ‰ç”Ÿæˆ3Dåœ°è´¨ä½“');
            log('reportResult', '2. åç«¯ç¼ºå°‘ä¾èµ–: email-validator, passlib');
            log('reportResult', '3. Logoæ˜¾ç¤ºé—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰');
            log('reportResult', '4. å³é”®é€€å‡ºç¼–è¾‘æ¨¡å¼åŠŸèƒ½ï¼ˆå·²æ·»åŠ ï¼‰');
            log('reportResult', '');
            
            log('reportResult', 'âœ… å»ºè®®è§£å†³æ–¹æ¡ˆ:');
            log('reportResult', '1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·(F12) â†’ ConsoleæŸ¥çœ‹è¯¦ç»†æ—¥å¿—');
            log('reportResult', '2. æ£€æŸ¥replayEngineæ˜¯å¦æ­£ç¡®æ¥æ”¶CSVæ•°æ®');
            log('reportResult', '3. éªŒè¯3Dåœºæ™¯æ˜¯å¦æ­£ç¡®æ›´æ–°');
            log('reportResult', '4. å®‰è£…ç¼ºå¤±çš„Pythonä¾èµ–');
            log('reportResult', '');
            
            log('reportResult', 'ğŸš€ å¿«é€Ÿä¿®å¤å‘½ä»¤:');
            log('reportResult', 'cd deep_excavation');
            log('reportResult', 'pip install email-validator passlib');
            log('reportResult', 'python start_simple.py  # å¯åŠ¨åç«¯');
            log('reportResult', 'python run_frontend.py  # å¯åŠ¨å‰ç«¯');
            log('reportResult', '');
            
            log('reportResult', 'ğŸ“– è°ƒè¯•æ­¥éª¤:');
            log('reportResult', '1. ä¸Šä¼ CSVæ–‡ä»¶');
            log('reportResult', '2. æ‰“å¼€F12æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—');
            log('reportResult', '3. æŸ¥æ‰¾"ğŸ”ï¸ å¼€å§‹åˆ›å»ºåœ°è´¨è¡¨é¢"ç­‰è°ƒè¯•ä¿¡æ¯');
            log('reportResult', '4. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æˆ–è­¦å‘Š');
            
            log('reportResult', '=== æŠ¥å‘Šç»“æŸ ===', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            log('reportResult', 'ğŸš€ DeepCAD Pro è°ƒè¯•å·¥å…·å·²åŠ è½½');
            log('reportResult', 'ğŸ’¡ å»ºè®®å…ˆæ£€æŸ¥å‰ç«¯å’Œåç«¯è¿æ¥çŠ¶æ€');
        };
    </script>
</body>
</html> 