# å¯è§†åŒ–æ¨¡å—æ‰©å±•æ–¹æ¡ˆ - ä¿æŒç°æœ‰é£æ ¼
**åŸºäºç°æœ‰ä»£ç **: PostProcessingPanel.tsx + PyVistaViewer.tsx  
**ç›®æ ‡**: ä¸ºå›ºä½“åŠ›å­¦å’Œæ¸—æµåˆ†ææ‰©å±•ï¼Œä¿æŒå‚æ•°å’Œé£æ ¼ä¸å˜

---

## ğŸ“Š **ç°æœ‰é£æ ¼åˆ†æ**

### ğŸ¨ **ç•Œé¢é£æ ¼ç‰¹è‰²**
```tsx
// ç°æœ‰çš„ä¼˜ç§€è®¾è®¡ç‰¹è‰²
- Ant Designç»„ä»¶ä½“ç³» (Card, Tabs, Slider, Select, Switch)
- å°å°ºå¯¸ç»„ä»¶ (size="small")
- å¡ç‰‡å¼å¸ƒå±€ (Card + TabPane)
- å›¾æ ‡+æ–‡å­—çš„Tabè®¾è®¡
- æ»‘å—æ•°å€¼æ˜¾ç¤º (é€æ˜åº¦: {opacity})
- é¢œè‰²æ ‡ç­¾ç³»ç»Ÿ (Tag color="blue")
- å®æ—¶è¿›åº¦æç¤º (Progress + Alert)
- WebSocketå®æ—¶æ›´æ–°
```

### ğŸ›ï¸ **ç°æœ‰å‚æ•°è®¾ç½®**
```tsx
// åˆ†æç±»å‹ - ä¿æŒä¸å˜
<Option value="structural">ç»“æ„åˆ†æ</Option>
<Option value="thermal">ä¼ çƒ­åˆ†æ</Option>
<Option value="geomechanics">å²©åœŸåˆ†æ</Option>  // ğŸ‘ˆ å·²æœ‰!
<Option value="coupled">è€¦åˆåˆ†æ</Option>      // ğŸ‘ˆ å·²æœ‰!

// æ¸²æŸ“è®¾ç½® - ä¿æŒä¸å˜
render_mode: 'solid' | 'wireframe' | 'points' | 'transparent' | 'x-ray'
show_edges: boolean
opacity: number (0-1, step=0.1)
color_map: 'viridis' | 'plasma' | 'jet' | 'rainbow' | 'coolwarm'

// å˜å½¢æ˜¾ç¤º - ä¿æŒä¸å˜
show_deformation: boolean
deformation_scale: number (0.1-10.0, step=0.1)
```

---

## ğŸš€ **æ‰©å±•æ–¹æ¡ˆï¼šåœ¨ç°æœ‰åŸºç¡€ä¸Šå¢åŠ **

### **æ–¹æ¡ˆ1: åœ¨ç°æœ‰TabPaneä¸­å¢åŠ å­é€‰é¡¹**

#### **æ‰©å±•"åˆ†æ"Tab - å¢åŠ æ¸—æµå‚æ•°**
```tsx
// åœ¨ç°æœ‰çš„ renderAnalysisSettings() ä¸­å¢åŠ 
const renderAnalysisSettings = () => (
  <Space direction="vertical" style={{ width: '100%' }}>
    {/* ç°æœ‰çš„åˆ†æç±»å‹é€‰æ‹© - ä¿æŒä¸å˜ */}
    <div>
      <Text strong>åˆ†æç±»å‹:</Text>
      <Select value={analysisType} onChange={setAnalysisType}>
        <Option value="structural">ç»“æ„åˆ†æ</Option>
        <Option value="geomechanics">å²©åœŸåˆ†æ</Option>
        <Option value="seepage">æ¸—æµåˆ†æ</Option>      {/* ğŸ‘ˆ æ–°å¢ */}
        <Option value="coupled">è€¦åˆåˆ†æ</Option>
      </Select>
    </div>

    {/* ğŸ†• æ ¹æ®åˆ†æç±»å‹æ˜¾ç¤ºä¸åŒå‚æ•° */}
    {analysisType === 'seepage' && (
      <div style={{ background: '#f6ffed', padding: 8, borderRadius: 4 }}>
        <Text strong style={{ color: '#52c41a' }}>æ¸—æµåˆ†æå‚æ•°:</Text>
        <Row gutter={8} style={{ marginTop: 4 }}>
          <Col span={12}>
            <Text>æ¸—é€ç³»æ•°:</Text>
            <InputNumber
              value={seepageParams.permeability}
              onChange={(value) => setSeepageParams({...seepageParams, permeability: value})}
              min={1e-9}
              max={1e-3}
              step={1e-6}
              size="small"
              style={{ width: '100%' }}
            />
          </Col>
          <Col span={12}>
            <Text>æ°´ä½(m):</Text>
            <InputNumber
              value={seepageParams.water_level}
              onChange={(value) => setSeepageParams({...seepageParams, water_level: value})}
              min={-50}
              max={10}
              step={0.5}
              size="small"
              style={{ width: '100%' }}
            />
          </Col>
        </Row>
      </div>
    )}

    {/* ç°æœ‰çš„ç½‘æ ¼å‚æ•° - ä¿æŒä¸å˜ */}
    <Row gutter={8}>
      <Col span={12}>
        <Text>èŠ‚ç‚¹æ•°:</Text>
        <InputNumber value={meshNodes} onChange={setMeshNodes} />
      </Col>
      <Col span={12}>
        <Text>å•å…ƒæ•°:</Text>
        <InputNumber value={meshElements} onChange={setMeshElements} />
      </Col>
    </Row>
  </Space>
);
```

#### **æ‰©å±•"å­—æ®µ"Tab - å¢åŠ æ¸—æµå­—æ®µ**
```tsx
// åœ¨ç°æœ‰å­—æ®µé€‰æ‹©ä¸­å¢åŠ æ¸—æµå­—æ®µé€‰é¡¹
const getAvailableFields = (analysisType: string) => {
  const baseFields = [
    // ç»“æ„å­—æ®µ - ä¿æŒç°æœ‰
    { name: 'von_mises_stress', display_name: 'Von Misesåº”åŠ›', unit: 'Pa' },
    { name: 'displacement', display_name: 'ä½ç§»', unit: 'm' },
    { name: 'strain', display_name: 'åº”å˜', unit: '-' },
  ];

  if (analysisType === 'seepage') {
    return [
      ...baseFields,
      // ğŸ†• æ¸—æµå­—æ®µ
      { name: 'hydraulic_head', display_name: 'æ°´å¤´', unit: 'm' },
      { name: 'pore_pressure', display_name: 'å­”éš™æ°´å‹åŠ›', unit: 'Pa' },
      { name: 'seepage_velocity', display_name: 'æ¸—æµé€Ÿåº¦', unit: 'm/s' },
      { name: 'flow_rate', display_name: 'æµé‡', unit: 'mÂ³/s' }
    ];
  }
  
  return baseFields;
};
```

### **æ–¹æ¡ˆ2: æ–°å¢ä¸“é—¨çš„æ¸—æµTab**

#### **åœ¨ç°æœ‰Tabsä¸­å¢åŠ "æ¸—æµ"Tab**
```tsx
<Tabs size="small" type="card">
  {/* ç°æœ‰Tabä¿æŒä¸å˜ */}
  <TabPane tab={<span><ThunderboltOutlined />åˆ†æ</span>} key="analysis">
    {renderAnalysisSettings()}
  </TabPane>
  
  <TabPane tab={<span><HeatMapOutlined />å­—æ®µ</span>} key="fields">
    {renderFieldControls()}
  </TabPane>
  
  <TabPane tab={<span><CompressOutlined />å˜å½¢</span>} key="deformation">
    {renderDeformationControls()}
  </TabPane>

  {/* ğŸ†• æ–°å¢æ¸—æµä¸“ç”¨Tab */}
  {(analysisType === 'seepage' || analysisType === 'coupled') && (
    <TabPane tab={<span><CloudOutlined />æ¸—æµ</span>} key="seepage">
      {renderSeepageControls()}
    </TabPane>
  )}
</Tabs>
```

#### **æ¸—æµæ§åˆ¶é¢æ¿ - éµå¾ªç°æœ‰é£æ ¼**
```tsx
const renderSeepageControls = () => (
  <Space direction="vertical" style={{ width: '100%' }}>
    {/* è¾¹ç•Œæ¡ä»¶æ˜¾ç¤ºæ§åˆ¶ */}
    <div>
      <Text strong>è¾¹ç•Œæ¡ä»¶æ˜¾ç¤º:</Text>
      <Space wrap style={{ marginTop: 4 }}>
        <Switch 
          checkedChildren="å®šæ°´å¤´" 
          unCheckedChildren="å®šæ°´å¤´"
          checked={seepageBoundary.constant_head}
          onChange={(checked) => setSeepageBoundary({...seepageBoundary, constant_head: checked})}
          size="small"
        />
        <Switch 
          checkedChildren="ä¸é€æ°´" 
          unCheckedChildren="ä¸é€æ°´"
          checked={seepageBoundary.impermeable}
          onChange={(checked) => setSeepageBoundary({...seepageBoundary, impermeable: checked})}
          size="small"
        />
        <Switch 
          checkedChildren="æ¸—å‡ºé¢" 
          unCheckedChildren="æ¸—å‡ºé¢"
          checked={seepageBoundary.seepage_face}
          onChange={(checked) => setSeepageBoundary({...seepageBoundary, seepage_face: checked})}
          size="small"
        />
      </Space>
    </div>

    {/* æµçº¿æ˜¾ç¤ºæ§åˆ¶ - éµå¾ªç°æœ‰æ»‘å—é£æ ¼ */}
    <div>
      <Text strong>æµçº¿å¯†åº¦: {streamlineSettings.density}</Text>
      <Slider
        min={0.1}
        max={2.0}
        step={0.1}
        value={streamlineSettings.density}
        onChange={(value) => setStreamlineSettings({...streamlineSettings, density: value})}
        tooltip={{ formatter: (value) => `${value}x` }}
      />
    </div>

    {/* æ¸—æµåŠ¨ç”»æ§åˆ¶ - éµå¾ªç°æœ‰åŠ¨ç”»é£æ ¼ */}
    <div>
      <Text strong>æ¸—æµæ¼”åŒ–åŠ¨ç”»:</Text>
      <Row gutter={8} style={{ marginTop: 4 }}>
        <Col span={12}>
          <Button
            icon={seepageAnimation.playing ? <PauseOutlined /> : <PlayCircleOutlined />}
            onClick={() => toggleSeepageAnimation()}
            block
            size="small"
          >
            {seepageAnimation.playing ? 'æš‚åœ' : 'æ’­æ”¾'}
          </Button>
        </Col>
        <Col span={12}>
          <Button
            icon={<ReloadOutlined />}
            onClick={() => resetSeepageAnimation()}
            block
            size="small"
          >
            é‡ç½®
          </Button>
        </Col>
      </Row>
    </div>

    {/* æ—¶é—´æ§åˆ¶ - éµå¾ªç°æœ‰æ—¶é—´æ»‘å—é£æ ¼ */}
    <div>
      <Text>æ—¶é—´: {currentTime.toFixed(1)} å¤©</Text>
      <Slider
        min={0}
        max={totalTime}
        value={currentTime}
        onChange={setCurrentTime}
        tooltip={{ formatter: (value) => `${value} å¤©` }}
      />
    </div>
  </Space>
);
```

### **æ–¹æ¡ˆ3: æ‰©å±•PyVistaViewerçš„æ¸²æŸ“æ¨¡å¼**

#### **åœ¨ç°æœ‰æ¸²æŸ“æ¨¡å¼ä¸­å¢åŠ æ¸—æµä¸“ç”¨æ¨¡å¼**
```tsx
// åœ¨ç°æœ‰çš„æ¸²æŸ“è®¾ç½®Tabä¸­å¢åŠ 
<div>
  <Text strong>æ¸²æŸ“æ¨¡å¼:</Text>
  <Select value={renderSettings.render_mode} onChange={updateRenderMode}>
    {/* ç°æœ‰æ¨¡å¼ä¿æŒä¸å˜ */}
    <Option value="solid">å®ä½“</Option>
    <Option value="wireframe">çº¿æ¡†</Option>
    <Option value="points">ç‚¹äº‘</Option>
    <Option value="transparent">é€æ˜</Option>
    <Option value="x-ray">Xå°„çº¿</Option>
    
    {/* ğŸ†• æ¸—æµä¸“ç”¨æ¨¡å¼ */}
    {(analysisType === 'seepage' || analysisType === 'coupled') && [
      <Option key="streamlines" value="streamlines">æµçº¿æ¨¡å¼</Option>,
      <Option key="flow_vectors" value="flow_vectors">æµé€ŸçŸ¢é‡</Option>,
      <Option key="contour_filled" value="contour_filled">å¡«å……ç­‰å€¼çº¿</Option>
    ]}
  </Select>
</div>

{/* ğŸ†• æ¸—æµæ¨¡å¼ä¸“ç”¨è®¾ç½® - ä»…åœ¨æ¸—æµæ¨¡å¼æ—¶æ˜¾ç¤º */}
{renderSettings.render_mode === 'streamlines' && (
  <div style={{ background: '#e6f7ff', padding: 8, borderRadius: 4 }}>
    <Text strong style={{ color: '#1890ff' }}>æµçº¿è®¾ç½®:</Text>
    <div style={{ marginTop: 4 }}>
      <Text>èµ·å§‹ç‚¹å¯†åº¦: {streamlineSettings.start_density}</Text>
      <Slider
        min={10}
        max={100}
        step={5}
        value={streamlineSettings.start_density}
        onChange={(value) => setStreamlineSettings({...streamlineSettings, start_density: value})}
        tooltip={{ formatter: (value) => `${value}ç‚¹` }}
      />
    </div>
    <div>
      <Text>æµçº¿é•¿åº¦: {streamlineSettings.max_length}</Text>
      <Slider
        min={1}
        max={10}
        step={0.5}
        value={streamlineSettings.max_length}
        onChange={(value) => setStreamlineSettings({...streamlineSettings, max_length: value})}
        tooltip={{ formatter: (value) => `${value}m` }}
      />
    </div>
  </div>
)}
```

---

## ğŸ¨ **é¢œè‰²æ˜ å°„æ‰©å±• - ä¿æŒç°æœ‰é£æ ¼**

### **ä¸ºæ¸—æµåˆ†æå¢åŠ ä¸“é—¨çš„é¢œè‰²æ˜ å°„**
```tsx
// åœ¨ç°æœ‰é¢œè‰²æ˜ å°„åŸºç¡€ä¸Šå¢åŠ æ¸—æµä¸“ç”¨
const getColorMappingOptions = (analysisType: string, currentField: string) => {
  // ç°æœ‰çš„é€šç”¨é¢œè‰²æ˜ å°„ - ä¿æŒä¸å˜
  const baseColormaps = [
    <Option key="viridis" value="viridis">Viridis</Option>,
    <Option key="plasma" value="plasma">Plasma</Option>,
    <Option key="jet" value="jet">Jet</Option>,
    <Option key="rainbow" value="rainbow">Rainbow</Option>,
    <Option key="coolwarm" value="coolwarm">å†·æš–è‰²</Option>
  ];

  // ğŸ†• æ¸—æµä¸“ç”¨é¢œè‰²æ˜ å°„
  if (analysisType === 'seepage') {
    const seepageColormaps = [
      <Option key="blues" value="blues">è“è‰²æ¸å˜ (æ°´å¤´)</Option>,
      <Option key="rdylbu" value="rdylbu">çº¢é»„è“ (å‹åŠ›)</Option>,
      <Option key="seismic" value="seismic">åœ°éœ‡è‰² (æµé€Ÿ)</Option>
    ];
    
    return [...baseColormaps, ...seepageColormaps];
  }

  return baseColormaps;
};
```

---

## ğŸ“Š **æ•°æ®å­—æ®µæ‰©å±•æ–¹æ¡ˆ**

### **ä¿æŒç°æœ‰å­—æ®µç»“æ„ï¼Œå¢åŠ æ¸—æµå­—æ®µ**
```tsx
// ç°æœ‰å­—æ®µä¿¡æ¯æ¥å£ - ä¿æŒä¸å˜
interface FieldInfo {
  name: string;
  display_name: string;
  unit: string;
  data_range?: [number, number];
  colormap?: string;
}

// ğŸ†• æ¸—æµå­—æ®µå®šä¹‰
const SEEPAGE_FIELDS: FieldInfo[] = [
  {
    name: 'hydraulic_head',
    display_name: 'æ°´å¤´',
    unit: 'm',
    data_range: [-20, 5],
    colormap: 'blues'  // è“è‰²é€‚åˆæ°´å¤´
  },
  {
    name: 'pore_pressure', 
    display_name: 'å­”éš™æ°´å‹åŠ›',
    unit: 'kPa',
    data_range: [-50, 200],
    colormap: 'rdylbu'  // çº¢é»„è“é€‚åˆå‹åŠ›
  },
  {
    name: 'seepage_velocity_magnitude',
    display_name: 'æ¸—æµé€Ÿåº¦å¤§å°', 
    unit: 'm/day',
    data_range: [0, 0.1],
    colormap: 'viridis'  // ä¿æŒç°æœ‰ç»å…¸é…è‰²
  },
  {
    name: 'flow_rate',
    display_name: 'å•ä½æµé‡',
    unit: 'mÂ²/day',
    data_range: [0, 1.0],
    colormap: 'plasma'
  }
];
```

---

## ğŸ”„ **WebSocketæ¶ˆæ¯æ‰©å±• - ä¿æŒç°æœ‰æ ¼å¼**

### **åœ¨ç°æœ‰æ¶ˆæ¯å¤„ç†ä¸­å¢åŠ æ¸—æµäº‹ä»¶**
```tsx
// ç°æœ‰WebSocketå¤„ç† - ä¿æŒä¸å˜
const handleWebSocketMessage = (event: MessageEvent) => {
  const data = JSON.parse(event.data);
  
  switch (data.type) {
    // ç°æœ‰æ¶ˆæ¯ç±»å‹ä¿æŒä¸å˜
    case 'postprocessing_completed':
    case 'field_updated':  
    case 'colormap_updated':
    case 'deformation_updated':
      // ç°æœ‰å¤„ç†é€»è¾‘
      break;
      
    // ğŸ†• æ¸—æµä¸“ç”¨æ¶ˆæ¯ç±»å‹
    case 'seepage_analysis_completed':
      handleSeepageAnalysisCompleted(data);
      break;
    case 'streamlines_updated':
      handleStreamlinesUpdated(data);  
      break;
    case 'seepage_animation_frame':
      handleSeepageAnimationFrame(data);
      break;
  }
};
```

---

## ğŸ“ **å®æ–½å»ºè®®**

### **Phase 1: æœ€å°ä¾µå…¥å¼æ‰©å±•**
1. **ä¿æŒç°æœ‰æ‰€æœ‰ä»£ç ä¸å˜**
2. **åœ¨åˆ†æç±»å‹ä¸­å¢åŠ "seepage"é€‰é¡¹**
3. **åœ¨å­—æ®µåˆ—è¡¨ä¸­å¢åŠ æ¸—æµå­—æ®µ**  
4. **æµ‹è¯•ç°æœ‰åŠŸèƒ½æ— å½±å“**

### **Phase 2: æ¸è¿›å¼åŠŸèƒ½å¢åŠ **
1. **å¢åŠ æ¸—æµä¸“ç”¨Tabï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰**
2. **å¢åŠ æ¸—æµä¸“ç”¨é¢œè‰²æ˜ å°„**
3. **å¢åŠ æµçº¿æ¸²æŸ“æ¨¡å¼**
4. **æµ‹è¯•æ–°åŠŸèƒ½ä¸ç°æœ‰åŠŸèƒ½çš„å…¼å®¹æ€§**

### **Phase 3: æ·±åº¦é›†æˆä¼˜åŒ–**
1. **ä¼˜åŒ–æ¸—æµåŠ¨ç”»æ€§èƒ½**
2. **å®Œå–„æ¸—æµè¾¹ç•Œæ¡ä»¶æ˜¾ç¤º**
3. **é›†æˆè€¦åˆåˆ†æå¯è§†åŒ–**
4. **å…¨é¢æµ‹è¯•å’Œä¼˜åŒ–**

---

**æ€»ç»“**: å®Œå…¨ä¿æŒç°æœ‰PostProcessingPanelå’ŒPyVistaViewerçš„ä¼˜ç§€è®¾è®¡é£æ ¼ï¼Œé€šè¿‡æ¡ä»¶æ˜¾ç¤ºã€å­—æ®µæ‰©å±•ã€é¢œè‰²æ˜ å°„å¢åŠ ç­‰æ–¹å¼ï¼Œæ— ç¼é›†æˆå›ºä½“åŠ›å­¦å’Œæ¸—æµåˆ†æçš„å¯è§†åŒ–åŠŸèƒ½ã€‚æ‰€æœ‰ç°æœ‰å‚æ•°ã€å¸ƒå±€ã€äº¤äº’æ–¹å¼ä¿æŒä¸å˜ã€‚