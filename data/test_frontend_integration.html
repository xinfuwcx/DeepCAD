<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’»å­”æ•°æ®å‰ç«¯é›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a2e;
            color: #ffffff;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            padding: 16px;
        }
        .borehole-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .borehole-table th, .borehole-table td {
            border: 1px solid rgba(0, 217, 255, 0.3);
            padding: 8px;
            text-align: left;
        }
        .borehole-table th {
            background: rgba(0, 217, 255, 0.2);
        }
        .soil-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            vertical-align: middle;
        }
        button {
            background: rgba(0, 217, 255, 0.8);
            border: none;
            color: #000;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: rgba(0, 217, 255, 1.0);
        }
    </style>
</head>
<body>
    <h1>ğŸŒ DeepCADé’»å­”æ•°æ®é›†æˆæµ‹è¯•</h1>
    <p>æµ‹è¯•ç”Ÿæˆçš„100ä¸ªé’»å­”æ•°æ®æ˜¯å¦èƒ½æ­£ç¡®å¯¼å…¥å‰ç«¯ç•Œé¢</p>
    
    <div>
        <button onclick="loadBoreholeData()">ğŸ“‚ åŠ è½½é’»å­”æ•°æ®</button>
        <button onclick="exportToGeologyModule()">ğŸ”„ å¯¼å‡ºåˆ°åœ°è´¨å»ºæ¨¡</button>
        <button onclick="visualizeDistribution()">ğŸ“Š å¯è§†åŒ–åˆ†å¸ƒ</button>
    </div>

    <div id="stats" class="stats"></div>
    <div id="visualization"></div>
    <div id="data-table"></div>

    <script>
        let boreholeData = null;
        
        const soilColors = {
            fill: '#D2B48C',
            clay: '#8B4513', 
            silt: '#DDD',
            sand: '#F4A460',
            gravel: '#696969',
            rock: '#2F4F4F'
        };

        async function loadBoreholeData() {
            try {
                const response = await fetch('./boreholes_for_import.json');
                boreholeData = await response.json();
                
                console.log('âœ… é’»å­”æ•°æ®åŠ è½½æˆåŠŸ:', boreholeData);
                
                displayStats();
                displayDataTable();
                
                alert(`æˆåŠŸåŠ è½½ ${boreholeData.length} ä¸ªé’»å­”æ•°æ®ï¼`);
            } catch (error) {
                console.error('âŒ åŠ è½½é’»å­”æ•°æ®å¤±è´¥:', error);
                alert('æ•°æ®åŠ è½½å¤±è´¥: ' + error.message);
            }
        }
        
        function displayStats() {
            if (!boreholeData) return;
            
            const totalBoreholes = boreholeData.length;
            const totalStrata = boreholeData.reduce((sum, bh) => sum + bh.strata.length, 0);
            
            const xCoords = boreholeData.map(bh => bh.x);
            const yCoords = boreholeData.map(bh => bh.y);
            const depths = boreholeData.map(bh => bh.total_depth);
            const elevations = boreholeData.map(bh => bh.ground_elevation);
            
            // åœŸå±‚ç»Ÿè®¡
            const soilTypeCount = {};
            boreholeData.forEach(bh => {
                bh.strata.forEach(stratum => {
                    soilTypeCount[stratum.soil_type] = (soilTypeCount[stratum.soil_type] || 0) + 1;
                });
            });
            
            const statsHTML = `
                <div class="stat-card">
                    <h3>ğŸŒ åŸºæœ¬ç»Ÿè®¡</h3>
                    <p><strong>é’»å­”æ€»æ•°:</strong> ${totalBoreholes}</p>
                    <p><strong>åœŸå±‚æ€»æ•°:</strong> ${totalStrata}</p>
                    <p><strong>å¹³å‡æ¯å­”:</strong> ${(totalStrata/totalBoreholes).toFixed(1)} å±‚</p>
                </div>
                
                <div class="stat-card">
                    <h3>ğŸ“ ç©ºé—´åˆ†å¸ƒ</h3>
                    <p><strong>XèŒƒå›´:</strong> ${Math.min(...xCoords).toFixed(1)} ~ ${Math.max(...xCoords).toFixed(1)} m</p>
                    <p><strong>YèŒƒå›´:</strong> ${Math.min(...yCoords).toFixed(1)} ~ ${Math.max(...yCoords).toFixed(1)} m</p>
                    <p><strong>è¦†ç›–é¢ç§¯:</strong> ${((Math.max(...xCoords) - Math.min(...xCoords)) * (Math.max(...yCoords) - Math.min(...yCoords)) / 10000).toFixed(1)} å…¬é¡·</p>
                </div>
                
                <div class="stat-card">
                    <h3>ğŸ“ æ·±åº¦ç»Ÿè®¡</h3>
                    <p><strong>åœ°é¢æ ‡é«˜:</strong> ${Math.min(...elevations).toFixed(1)} ~ ${Math.max(...elevations).toFixed(1)} m</p>
                    <p><strong>é’»å­”æ·±åº¦:</strong> ${Math.min(...depths).toFixed(1)} ~ ${Math.max(...depths).toFixed(1)} m</p>
                    <p><strong>å¹³å‡æ·±åº¦:</strong> ${(depths.reduce((a,b) => a+b, 0)/depths.length).toFixed(1)} m</p>
                </div>
                
                <div class="stat-card">
                    <h3>ğŸ—‚ï¸ åœŸå±‚ç±»å‹</h3>
                    ${Object.entries(soilTypeCount)
                        .sort((a, b) => b[1] - a[1])
                        .map(([type, count]) => `
                            <p>
                                <span class="soil-color" style="background-color: ${soilColors[type] || '#666'}"></span>
                                <strong>${type}:</strong> ${count}æ®µ (${(count/totalStrata*100).toFixed(1)}%)
                            </p>
                        `).join('')}
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHTML;
        }
        
        function displayDataTable() {
            if (!boreholeData) return;
            
            const tableHTML = `
                <h3>ğŸ“‹ é’»å­”æ•°æ®é¢„è§ˆï¼ˆå‰10ä¸ªï¼‰</h3>
                <table class="borehole-table">
                    <thead>
                        <tr>
                            <th>é’»å­”ç¼–å·</th>
                            <th>Xåæ ‡(m)</th>
                            <th>Yåæ ‡(m)</th>
                            <th>åœ°é¢æ ‡é«˜(m)</th>
                            <th>æ€»æ·±åº¦(m)</th>
                            <th>åœŸå±‚æ•°</th>
                            <th>ä¸»è¦åœŸç±»</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${boreholeData.slice(0, 10).map(bh => {
                            const mainSoilTypes = [...new Set(bh.strata.map(s => s.soil_type))];
                            return `
                                <tr>
                                    <td>${bh.name}</td>
                                    <td>${bh.x.toFixed(2)}</td>
                                    <td>${bh.y.toFixed(2)}</td>
                                    <td>${bh.ground_elevation.toFixed(2)}</td>
                                    <td>${bh.total_depth.toFixed(1)}</td>
                                    <td>${bh.strata.length}</td>
                                    <td>
                                        ${mainSoilTypes.map(type => `
                                            <span class="soil-color" style="background-color: ${soilColors[type] || '#666'}"></span>${type}
                                        `).join(' ')}
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('data-table').innerHTML = tableHTML;
        }
        
        function exportToGeologyModule() {
            if (!boreholeData) {
                alert('è¯·å…ˆåŠ è½½é’»å­”æ•°æ®');
                return;
            }
            
            // æ„é€ é€‚é…GeologyParamsAdvancedçš„å®Œæ•´å‚æ•°
            const geologyParams = {
                boreholes: boreholeData,
                domain: {
                    extension_method: 'convex_hull',
                    x_extend: 100,
                    y_extend: 100,
                    bottom_elevation: -35,
                    mesh_resolution: 2.0
                },
                algorithm: {
                    core_radius: 80,
                    transition_distance: 200,
                    variogram_model: 'spherical',
                    trend_order: 'linear',
                    uncertainty_analysis: false
                },
                gmsh_params: {
                    characteristic_length: 2.0,
                    physical_groups: false,
                    mesh_quality: 0.8
                }
            };
            
            console.log('ğŸ”„ å¯¼å‡ºåˆ°åœ°è´¨å»ºæ¨¡æ¨¡å—:', geologyParams);
            
            // è¿™é‡Œåº”è¯¥è°ƒç”¨å‰ç«¯çš„åœ°è´¨å»ºæ¨¡æ¥å£
            // onParamsChange(geologyParams);
            // onGenerate(geologyParams);
            
            alert(`å·²å¯¼å‡º ${boreholeData.length} ä¸ªé’»å­”åˆ°åœ°è´¨å»ºæ¨¡æ¨¡å—ï¼\\næ¨èå‚æ•°:\\n- æ ¸å¿ƒåŒºåŠå¾„: 80m\\n- è¿‡æ¸¡è·ç¦»: 200m\\n- ç½‘æ ¼åˆ†è¾¨ç‡: 2.0m`);
        }
        
        function visualizeDistribution() {
            if (!boreholeData) {
                alert('è¯·å…ˆåŠ è½½é’»å­”æ•°æ®');
                return;
            }
            
            // ç®€å•çš„ASCIIå¯è§†åŒ–
            const xCoords = boreholeData.map(bh => bh.x);
            const yCoords = boreholeData.map(bh => bh.y);
            
            const xMin = Math.min(...xCoords);
            const xMax = Math.max(...xCoords);
            const yMin = Math.min(...yCoords);
            const yMax = Math.max(...yCoords);
            
            const visualizationHTML = `
                <div class="stat-card">
                    <h3>ğŸ“Š é’»å­”ç©ºé—´åˆ†å¸ƒå¯è§†åŒ–</h3>
                    <p><strong>ç ”ç©¶åŒºåŸŸ:</strong> ${(xMax - xMin).toFixed(0)}m Ã— ${(yMax - yMin).toFixed(0)}m</p>
                    <p><strong>é’»å­”å¯†åº¦:</strong> ${(boreholeData.length / ((xMax - xMin) * (yMax - yMin) / 10000)).toFixed(2)} ä¸ª/å…¬é¡·</p>
                    <p><strong>å¹³å‡é—´è·:</strong> ${Math.sqrt(((xMax - xMin) * (yMax - yMin)) / boreholeData.length).toFixed(1)} m</p>
                    <canvas id="distribution-canvas" width="400" height="400" style="border: 1px solid #00d9ff; background: rgba(0,0,0,0.3);"></canvas>
                </div>
            `;
            
            document.getElementById('visualization').innerHTML = visualizationHTML;
            
            // ç»˜åˆ¶é’»å­”åˆ†å¸ƒå›¾
            const canvas = document.getElementById('distribution-canvas');
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#00d9ff';
            boreholeData.forEach(bh => {
                const x = ((bh.x - xMin) / (xMax - xMin)) * 380 + 10;
                const y = ((bh.y - yMin) / (yMax - yMin)) * 380 + 10;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
        window.onload = function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•é’»å­”æ•°æ®é›†æˆ...');
            loadBoreholeData();
        };
    </script>
</body>
</html>