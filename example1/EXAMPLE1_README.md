# Example1 - MSH数据处理完整工作流

这是一个完整的MSH数据处理示例，展示了从几何建模到数值分析再到结果可视化的全流程。

## 项目概述

Example1是一个岩土工程数值分析的完整样板，包含：
- **几何建模**: 土体、基坑、隧道的MSH网格生成
- **材料定义**: 高强度分层土体材料参数（类似软岩）
- **数值分析**: 基于Kratos的分步开挖分析
- **结果输出**: PyVista兼容的VTK格式结果

## 工程场景

### 几何模型
- **土体域**: 100×100×50m，分为7层，从表层硬塑粘土到基岩状土
- **基坑**: 25×25×12m，垂直开挖，无支护结构
- **隧道**: 50×5×3.5m，横穿土体，位于地下20m深度

### 分析步骤
1. **地应力平衡**: 建立初始应力状态
2. **隧道开挖**: 模拟隧道施工对周围土体的影响
3. **基坑开挖阶段1**: 上半部分开挖
4. **基坑开挖阶段2**: 最终开挖完成

### 材料参数（摩尔-库伦本构）
- **Layer_1**: E=50MPa, c=80kPa, φ=35°（表层硬塑粘土）
- **Layer_7**: E=2000MPa, c=1000kPa, φ=55°（基岩状土）
- 中间层次按线性梯度分布

## 文件结构

```
H:/DeepCAD/example1/
├── MSH网格文件:
│   ├── soil_domain.msh      # 土体域（二次四面体）
│   ├── excavation_pit.msh   # 基坑网格
│   └── tunnel.msh           # 隧道网格
│
├── 配置文件:
│   ├── materials.json       # Kratos材料配置
│   ├── analysis_config.json # 分析配置参数
│   └── materials_summary.txt # 材料参数汇总
│
├── 核心模块:
│   ├── msh_geometry_generator.py    # MSH文件生成器
│   ├── msh_materials_manager.py     # 材料参数管理
│   ├── msh_kratos_solver.py         # Kratos求解器集成
│   └── example1_desktop_interface.py # 桌面测试界面
│
├── 启动脚本:
│   └── start_example1.py    # 快速启动脚本
│
├── 文档:
│   ├── EXAMPLE1_README.md   # 本说明文档
│   └── 安装说明.txt         # 安装指南
│
└── output/                  # 输出目录
    └── vtk_output/          # VTK结果文件
```

```
H:/DeepCAD/example1/output/
└── vtk_output/
    ├── stage_1_results.vtk  # 地应力平衡结果
    ├── stage_2_results.vtk  # 隧道开挖结果
    ├── stage_3_results.vtk  # 基坑开挖第一阶段
    └── stage_4_results.vtk  # 基坑开挖最终结果
```

## 快速开始

### 方法1: 使用桌面界面（推荐）
```bash
cd H:/DeepCAD/example1
python start_example1.py
```

这将启动完整的图形界面，包含：
- 文件管理：生成和加载MSH文件
- 材料参数：配置土体材料属性
- 分析控制：运行分步开挖分析
- 结果显示：查看计算结果和VTK文件
- 运行日志：监控整个过程

### 方法2: 分步执行
```bash
cd H:/DeepCAD/example1

# 1. 生成MSH文件
python msh_geometry_generator.py

# 2. 生成材料配置
python msh_materials_manager.py

# 3. 运行Kratos分析
python msh_kratos_solver.py
```

## 技术特点

### 网格技术
- **单元类型**: 10节点二次四面体（TET10）
- **网格尺寸**: 自适应细化，关键区域2-3m，远场6-8m
- **网格质量**: 优化后质量系数>0.3

### 数值方法
- **求解器**: Kratos Newton-Raphson迭代
- **本构模型**: 摩尔-库伦塑性
- **边界条件**: 底面固定，侧面法向约束
- **荷载**: 重力+地表荷载+初始地应力

### 结果输出
- **格式**: VTK二进制格式
- **变量**: 位移、应力、应变、塑性应变
- **兼容性**: 支持PyVista、ParaView等可视化工具

## 预期结果

### 位移分析
- **最大位移**: 约25mm（基坑开挖完成后）
- **沉降模式**: 基坑周围形成沉降漏斗
- **隧道影响**: 隧道开挖引起上方地表微量沉降

### 应力分析
- **最大应力**: 约850kPa
- **应力集中**: 基坑角点和隧道腰部
- **应力重分布**: 开挖后应力向周围土体转移

### 监测点数据
- **隧道顶部**: 位移主要为竖向沉降
- **基坑角点**: 最大位移区域
- **地表沉降**: 影响范围约为开挖深度的2-3倍

## 系统要求

### 必需软件
- Python 3.8+
- GMSH (网格生成)
- NumPy (数值计算)

### 可选软件
- Kratos Multiphysics (真实分析，否则使用模拟模式)
- PyVista (结果可视化)
- meshio (MSH文件处理)

### 推荐配置
- 内存: 8GB+
- 存储: 1GB+
- CPU: 多核处理器

## 使用说明

### 启动Example1
当你说"启动example1"时，我会运行：
```bash
cd H:/DeepCAD/example1 && python start_example1.py
```

### 自定义参数
编辑配置文件来调整分析参数：
- `materials.json`: 修改土体材料参数
- `analysis_config.json`: 调整分析设置
- MSH生成器中的几何尺寸

### 结果分析
1. 查看VTK文件：使用PyVista或ParaView
2. 监测数据：分析各阶段的位移变化
3. 应力云图：识别应力集中区域

## 故障排除

### 常见问题
1. **Kratos未安装**: 系统自动切换到模拟模式
2. **GMSH路径问题**: 确保GMSH在系统PATH中
3. **内存不足**: 减小网格密度或增加虚拟内存

### 调试建议
1. 查看运行日志了解详细错误信息
2. 检查文件路径和权限
3. 验证输入文件格式

## 扩展功能

### 添加支护结构
- 修改MSH生成器添加地连墙
- 在材料配置中定义混凝土参数
- 更新分析步骤包含支护施工

### 多物理场耦合
- 添加渗流分析
- 考虑温度效应
- 包含动力分析

### 参数化研究
- 批量生成不同几何尺寸
- 自动化参数敏感性分析
- 优化设计参数

## 技术支持

这个Example1项目是一个完整的工程样板，可以作为：
- 岩土工程数值分析的学习案例
- MSH数据处理工作流的参考实现
- Kratos应用开发的起点
- PyVista可视化的示例

如有问题，请查看运行日志或联系技术支持。

---
**Example1 v1.0** - MSH数据处理完整工作流  
创建日期: 2025年  
适用于: 岩土工程、地下工程、数值分析