# PyVista桌面版软土深基坑分析

## 项目概述
专为桌面版设计的软土深基坑分析程序，使用PyVista进行前后处理，支持网格渐变和交互式可视化。

### 工程参数
- **土体域**: 500×500×30m
- **基坑**: 200×200×15m深基坑
- **地连墙**: 1.0m厚，22m深（入土7m）
- **土层**: 5层典型软土（杂填土→淤泥质粘土→粘土→粉质粘土→粉砂夹粘土）
- **网格渐变**: 0.3m（基坑附近）→ 1.0m（远场）

### 分析阶段
1. **地应力平衡** - 建立初始应力状态
2. **地连墙施工** - 激活围护结构
3. **第一层开挖** - 开挖至-5m
4. **第二层开挖** - 开挖至-10m  
5. **最终开挖** - 开挖至-15m

## 快速开始

### 1. 环境安装
```bash
# 安装依赖包
pip install -r requirements_pyvista.txt

# 核心依赖
pip install pyvista numpy scipy matplotlib

# 可选增强（推荐）
pip install gmsh meshio
```

### 2. 功能测试
```bash
# 运行测试脚本，验证环境
python test_pyvista_excavation.py
```

### 3. 运行分析
```bash
# 完整分析流程
python pyvista_soft_soil_excavation.py
```

## 核心特性

### 🔧 网格生成
- **GMSH集成**: 自动生成高质量四面体网格
- **尺寸渐变**: 基坑附近0.3m细网格，远场1.0m粗网格
- **几何复杂**: 支持土体域+基坑+地连墙的复杂几何

### 🧱 材料模型
- **5层软土**: 真实的软土地区土层参数
- **摩尔-库伦模型**: 经典土体本构关系
- **地连墙**: C30混凝土材料属性

### 🚀 分析功能
- **分阶段分析**: 模拟真实施工过程
- **大变形**: 考虑几何非线性
- **塑性分析**: 软土塑性变形
- **收敛控制**: 自适应求解策略

### 🎨 可视化
- **3D交互**: PyVista实时3D显示
- **多字段**: 位移、应力、应变等
- **动画**: 施工过程动态演示
- **导出**: VTK/PNG/GIF格式

## 文件结构

```
example1/
├── pyvista_soft_soil_excavation.py    # 主分析程序
├── test_pyvista_excavation.py         # 功能测试脚本
├── requirements_pyvista.txt           # 依赖包列表
├── README_PYVISTA_EXCAVATION.md       # 本说明文档
├── output/                            # 输出结果
│   └── pyvista_excavation/
│       ├── vtk/                       # VTK结果文件
│       ├── analysis_summary.json      # 分析报告
│       └── analysis_results.png       # 可视化图片
└── 其他配置文件...
```

## 土层参数详细

| 土层 | 深度(m) | E(MPa) | ν | c(kPa) | φ(°) | γ(kN/m³) | 描述 |
|------|---------|--------|---|--------|------|----------|------|
| 1 | 0→-2 | 4.0 | 0.40 | 8 | 10 | 17.0 | 杂填土 |
| 2 | -2→-8 | 2.5 | 0.45 | 12 | 8 | 16.5 | 淤泥质粘土 |
| 3 | -8→-16 | 6.0 | 0.38 | 18 | 12 | 18.0 | 粘土 |
| 4 | -16→-24 | 12.0 | 0.32 | 25 | 16 | 19.0 | 粉质粘土 |
| 5 | -24→-30 | 20.0 | 0.28 | 15 | 22 | 19.5 | 粉砂夹粘土 |

## 预期结果

### 典型数值指标
- **最大墙体位移**: 30-50mm
- **最大地表沉降**: 20-35mm  
- **最大墙体应力**: 10-20MPa
- **基坑稳定系数**: >1.2
- **分析时间**: 5-15分钟

### 关键检查点
1. **收敛性**: 各阶段是否收敛
2. **变形合理性**: 位移模式是否符合工程经验
3. **应力分布**: 应力集中是否合理
4. **稳定性**: 是否出现过大塑性区

## 使用技巧

### 网格质量控制
```python
# 调整网格尺寸
mesh_size_fine = 0.3    # 基坑附近细网格
mesh_size_coarse = 1.0  # 远场粗网格

# GMSH渐变控制
gmsh.model.mesh.field.setNumber(2, "DistMin", 10)   # 渐变起始距离
gmsh.model.mesh.field.setNumber(2, "DistMax", 50)   # 渐变结束距离
```

### 材料参数调整
```python
# 修改土层参数
soil_layers = [
    {"E": 4, "nu": 0.40, "c": 8, "phi": 10},  # 第1层
    # ... 其他层
]

# 地连墙参数
wall_props = {"E": 30000, "nu": 0.20, "gamma": 25.0}
```

### 可视化定制
```python
# 创建多窗口显示
plotter = pv.Plotter(shape=(2, 3))

# 添加自定义颜色映射
plotter.add_mesh(mesh, scalars="displacement", cmap="viridis")

# 保存动画
plotter.open_gif("excavation_process.gif")
```

## 故障排除

### 常见问题

1. **GMSH未安装**
   ```bash
   pip install gmsh
   # 或使用conda: conda install gmsh
   ```

2. **VTK显示问题**
   ```bash
   # 无头环境
   import pyvista as pv
   pv.set_plot_theme("document")
   pv.OFF_SCREEN = True
   ```

3. **内存不足**
   ```python
   # 减小网格密度
   mesh_size_fine = 0.5
   mesh_size_coarse = 1.5
   ```

4. **收敛困难**
   ```python
   # 增加迭代次数
   max_iterations = 200
   # 使用线搜索
   line_search = True
   ```

### 性能优化
- **并行计算**: 启用多核处理
- **内存管理**: 及时清理中间结果
- **网格优化**: 平衡精度和效率
- **结果压缩**: 选择性输出变量

## 扩展功能

### 高级分析
- **渗流耦合**: 地下水影响
- **动力分析**: 地震响应
- **温度场**: 水化热分析
- **施工荷载**: 机械荷载模拟

### 结果分析
- **时程分析**: 位移时间历程
- **截面分析**: 典型截面结果
- **监测点**: 关键位置追踪
- **安全评估**: 自动化安全检查

## 技术支持

- **文档**: 查看源码注释
- **测试**: 运行test_pyvista_excavation.py
- **调试**: 启用详细日志输出
- **社区**: PyVista官方文档和示例

---

**版本**: v1.0  
**更新**: 2025-01-01  
**适用**: 软土地区深基坑工程分析